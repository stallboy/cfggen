---
layout: page
title: å¿«é€Ÿå…¥é—¨
parent: é…è¡¨ç³»ç»Ÿ
nav_order: 1
---

# ğŸš€ å¿«é€Ÿå…¥é—¨

æ¬¢è¿ä½¿ç”¨ cfggen é…è¡¨ç³»ç»Ÿ!æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨åœ¨ **5 åˆ†é’Ÿå†…**å®Œæˆç¬¬ä¸€ä¸ªé…ç½®ç¤ºä¾‹ã€‚

---

## ğŸ“‹ å‰ç½®å‡†å¤‡

### 1. ç¯å¢ƒè¦æ±‚

- **Java 21** (è¿è¡Œ cfggen å’Œç”Ÿæˆçš„ä»£ç )
- **Excel** (ç¼–è¾‘æ•°æ®,å¯é€‰)
- **ä»»æ„æ–‡æœ¬ç¼–è¾‘å™¨** (VS Code æ¨èé…åˆ CFG æ’ä»¶)

### 2. ä¸‹è½½ cfggen

ä» [GitHub Releases](https://github.com/stallboy/cfggen/releases) ä¸‹è½½é¢„ç¼–è¯‘çš„ `cfggen.jar`ã€‚

æˆ–è€…ä»æºç æ„å»ºï¼š

```bash
genjar.bat # ç”Ÿæˆ cfggen.jar
```

ç”Ÿæˆçš„ `cfggen.jar` ä½äºé¡¹ç›®æ ¹ç›®å½•ã€‚

---

## â±ï¸ 5 åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹

### æ­¥éª¤ 1: åˆ›å»ºç¬¬ä¸€ä¸ªé…ç½®ç»“æ„ (1 åˆ†é’Ÿ)

åˆ›å»ºé…ç½®ç›®å½•å’Œå®šä¹‰æ–‡ä»¶:

```bash
# åˆ›å»ºé¡¹ç›®ç›®å½•
mkdir mygame
cd mygame
mkdir config
cd config

# åˆ›å»º item æ¨¡å—ç›®å½•
mkdir item

# åˆ›å»ºç»“æ„å®šä¹‰æ–‡ä»¶
touch item\item.cfg
```

æ‹·è´`cfggen.jar`åˆ°configç›®å½•

ç¼–è¾‘ `item\item.cfg`,å†™å…¥ä»¥ä¸‹å†…å®¹:

```cfg
// å†…åµŒç»“æ„ï¼Œå¥–åŠ±
struct Reward {
	itemId:int ->item;
	count:int;
}

// ç‰©å“ç±»å‹è¡¨
table itemtype[id] (enum='name') {
	id:int;
	name:str; // åç§°
}

// ç‰©å“è¡¨
table item[id] {
	id:int;
	name:str; // ç‰©å“åç§°
	type:int ->itemtype; // ç‰©å“ç±»å‹
	price:int; // ä»·æ ¼
	description:text; // æè¿°
	rewards:list<Reward> (pack);
}
```

**è¯´æ˜**:
- `struct`: å®šä¹‰å¤æ‚æ•°æ®ç»“æ„
- `table`: å®šä¹‰æ•°æ®è¡¨,`[id]` è¡¨ç¤ºä¸»é”®
- `enum='name'`: æ•°æ®è¡¨æ˜¯ä¸ªæšä¸¾è¡¨ï¼Œç”¨`name`å­—æ®µçš„å­—ç¬¦ä¸²ä½œä¸ºæšä¸¾å
- `->itemtype`: å¤–é”®å¼•ç”¨,æŒ‡å‘ itemtype è¡¨çš„ä¸»é”®id
- `list<Reward>`: åˆ—è¡¨ç±»å‹,åŒ…å« Reward ç»“æ„
- `pack`: è¡¨ç¤ºæŠŠå¥–åŠ±éƒ½é…ç½®åˆ°ä¸€ä¸ªæ ¼å­é‡Œ

### æ­¥éª¤ 2: å‡†å¤‡æ•°æ®æ–‡ä»¶ (2 åˆ†é’Ÿ)

#### æ–¹å¼ A: ä½¿ç”¨ Excel (æ¨è)

1. æ‰“å¼€ Excel,åˆ›å»º `item.xlsx`
2. åˆ›å»ºä¸¤ä¸ªå·¥ä½œè¡¨:

**å·¥ä½œè¡¨ 1: `itemtype`**

| id | åç§° |
|----|------|
| id | name |
| 1  | weapon |
| 2  | armor |
| 3  | consumable |

**å·¥ä½œè¡¨ 2: `item`**

| id | ç‰©å“åç§° | ç‰©å“ç±»å‹ | ä»·æ ¼ | æè¿° | rewards |
|----|------|------|-------|-------------|---------|
| id | name | type | price | description | rewards |
| 1001 | é“å‰‘ | 1 | 100 | ä¸€æŠŠæ™®é€šçš„é“å‰‘ |  |
| 1002 | é’¢ç›¾ | 2 | 150 | åšå›ºçš„é’¢ç›¾ |  |
| 2001 | åŒ…è£¹ | 3 | 200 | ä½¿ç”¨åå¾—åˆ°è£…å¤‡ | (1001,1),(1002,1) |

å°† `item.xlsx` ä¿å­˜åˆ° `config/` ç›®å½•ã€‚

### æ­¥éª¤ 3: ç”Ÿæˆä»£ç å’Œæ•°æ® (1 åˆ†é’Ÿ)

```bash
# ä» config ç›®å½•æ‰§è¡Œ
cd config
java -jar cfggen.jar -datadir . -gen java,dir:../java,configgendir:../java -gen javadata,file:../java/config.data
```

**ç”Ÿæˆç»“æœ**:
```
mygame/
â”œâ”€â”€ config/              # é…ç½®æºæ–‡ä»¶
â”‚   â””â”€â”€ cfggen.jar
â”‚   â””â”€â”€ item/            # item æ¨¡å—
â”‚       â”œâ”€â”€ item.cfg     # ç»“æ„å®šä¹‰
â”‚       â””â”€â”€ item.xlsx    # æ•°æ®æ–‡ä»¶
â”‚
â””â”€â”€java/                # ç”Ÿæˆçš„ä»£ç å’Œæ•°æ®
    â”œâ”€â”€ config/          # é…ç½®ç±»
    â”œâ”€â”€ configgen/       # Schema æ¡†æ¶ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
    â””â”€â”€ config.data      # æ•°æ®æ–‡ä»¶
```

**è¯´æ˜**:
- `-gen java,dir:../java,configgendir:../java`: ç”Ÿæˆ Java è®¿é—®ä»£ç åˆ° `../java` ç›®å½•ï¼ŒåŒæ—¶ç”Ÿæˆ Schema æ¡†æ¶æ–‡ä»¶
- `-gen javadata,file:../java/config.data`: ç”ŸæˆäºŒè¿›åˆ¶æ•°æ®æ–‡ä»¶åˆ° `../java/config.data`
- ç”Ÿæˆçš„ä»£ç ä½äº `java/config/` ç›®å½•
- Schema æ¡†æ¶æ–‡ä»¶è‡ªåŠ¨ç”Ÿæˆåˆ° `java/configgen/genjava/` ç›®å½•
- æ•°æ®æ–‡ä»¶ä¸º `java/config.data`

### æ­¥éª¤ 4: é…ç½® Gradle æ„å»º

```bash
cd ../java
# åˆ›å»ºsettings.gradle
echo rootProject.name = 'mygame' > settings.gradle
```

åˆ›å»º `build.gradle` æ–‡ä»¶ï¼š

```groovy
plugins {
    id 'application'
}

sourceSets {
    main {
        java {
            srcDirs = ['.']
        }
    }
}

compileJava {
    options.encoding = "UTF-8"
}

application {
    mainClass = 'LoadConfig'
}

jar {
    manifest {
        attributes 'Main-Class': 'LoadConfig'
    }
}
```

### æ­¥éª¤ 5: ä½¿ç”¨ç”Ÿæˆçš„ä»£ç  (1 åˆ†é’Ÿ)

åˆ›å»º `LoadConfig.java`:

```java
import config.ConfigCodeSchema;
import config.ConfigMgr;
import config.ConfigMgrLoader;
import configgen.genjava.ConfigInput;
import configgen.genjava.Schema;
import configgen.genjava.SchemaCompatibleException;

import java.io.DataInputStream;
import java.io.BufferedInputStream;
import java.io.FileInputStream;

public class LoadConfig {
    public static void main(String[] args) throws Exception {
        // 1. æ£€æŸ¥ Schema å…¼å®¹æ€§
        Schema codeSchema = ConfigCodeSchema.getCodeSchema();

        try (ConfigInput input = new ConfigInput(
                new DataInputStream(new BufferedInputStream(
                    new FileInputStream("config.data"))))) {

            // 2. è¯»å–æ•°æ®æ–‡ä»¶çš„ Schema
            Schema dataSchema = Schema.create(input);

            // 3. æ£€æŸ¥å…¼å®¹æ€§
            if (!codeSchema.compatible(dataSchema)) {
                throw new SchemaCompatibleException("schema not compatible");
            }

            // 4. åŠ è½½é…ç½®æ•°æ®
            ConfigMgr mgr = ConfigMgrLoader.load(input);
            ConfigMgr.setMgr(mgr);
        }

        // 5. ä½¿ç”¨é…ç½®
        config.item.Item item = config.item.Item.get(1001);
        System.out.println(item.getName());   // è¾“å‡º: é“å‰‘
        System.out.println(item.getPrice());  // è¾“å‡º: 100

        // 6. éå†æ‰€æœ‰é“å…·
        for (config.item.Item i : config.item.Item.all()) {
            System.out.println(i.getId() + ": " + i);
        }
    }
}
```

**è¿è¡Œç¨‹åº**:
```bash
# ç¼–è¯‘
gradle build

# è¿è¡Œ
gradle run

# æˆ–ç›´æ¥è¿è¡Œ JAR
java -jar build/libs/mygame.jar
```

**API è¯´æ˜**:
- `ConfigCodeSchema.getCodeSchema()`: è·å–ä»£ç å®šä¹‰çš„ Schema
- `Schema.create(input)`: ä»æ•°æ®æ–‡ä»¶è¯»å– Schema
- `codeSchema.compatible(dataSchema)`: æ£€æŸ¥å…¼å®¹æ€§
- `ConfigMgrLoader.load(input)`: åŠ è½½é…ç½®æ•°æ®
- `Item.get(id)`: æ ¹æ®ä¸»é”®è·å–è®°å½•
- `Item.all()`: è·å–æ‰€æœ‰è®°å½•çš„é›†åˆ

---

## ğŸ¯ ä¸‹ä¸€æ­¥å­¦ä¹ 

æ­å–œ!æ‚¨å·²ç»å®Œæˆäº†ç¬¬ä¸€ä¸ªé…ç½®ç¤ºä¾‹ã€‚æ¥ä¸‹æ¥å¯ä»¥å­¦ä¹ :

### 1ï¸âƒ£ æ·±å…¥ç»“æ„å®šä¹‰

- [ç»“æ„å®šä¹‰è¯¦è§£](./03.schema.md) - å­¦ä¹  structã€interfaceã€table çš„å®Œæ•´è¯­æ³•
- [ä¸»é”®ã€æšä¸¾ã€å¤–é”®](./04.key.md) - ç†è§£æ•°æ®å…³è”å’Œå¼•ç”¨
- [æ˜ å°„åˆ°è¡¨æ ¼](./05.tabularMapping.md) - Excel å•å…ƒæ ¼å¦‚ä½•æ˜ å°„åˆ°å¤æ‚æ•°æ®ç»“æ„

### 2ï¸âƒ£ é«˜çº§åŠŸèƒ½

- [æ ‡ç­¾ç³»ç»Ÿ](./06.tag.md) - å®¢æˆ·ç«¯/æœåŠ¡å™¨æ•°æ®åˆ†ç¦»
- [å›½é™…åŒ–æ”¯æŒ](./10.i18n.md) - å¤šè¯­è¨€é…ç½®
- [AI ç”Ÿæˆé…ç½®](../aigen/) - ä½¿ç”¨ AI è‡ªåŠ¨ç”Ÿæˆé…ç½®æ•°æ®

### 3ï¸âƒ£ å®è·µç¤ºä¾‹

æŸ¥çœ‹ `example/` ç›®å½•ä¸‹çš„å®Œæ•´ç¤ºä¾‹:

- `example/config/` - é…ç½®å®šä¹‰å’Œæ•°æ®æ–‡ä»¶
- `example/genjava.bat` - ç”Ÿæˆ Java ä»£ç å’Œæ•°æ®çš„å®Œæ•´è„šæœ¬
- `example/javaload/LoadConfig.java` - é…ç½®åŠ è½½ç¤ºä¾‹
- `example/build.gradle` - Gradle æ„å»ºé…ç½®ç¤ºä¾‹
