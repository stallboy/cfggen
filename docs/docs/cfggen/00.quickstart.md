---
layout: page
title: å¿«é€Ÿå…¥é—¨
parent: é…è¡¨ç³»ç»Ÿ
nav_order: 1
---

# ğŸš€ å¿«é€Ÿå…¥é—¨

æ¬¢è¿ä½¿ç”¨ cfggen é…è¡¨ç³»ç»Ÿ!æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨åœ¨ **5 åˆ†é’Ÿå†…**å®Œæˆç¬¬ä¸€ä¸ªé…ç½®ç¤ºä¾‹ã€‚

---

## ğŸ“‹ å‰ç½®å‡†å¤‡

### 1. ç¯å¢ƒè¦æ±‚

- **Java 21** (è¿è¡Œ cfggen å’Œç”Ÿæˆçš„ä»£ç )
- **Excel** (ç¼–è¾‘æ•°æ®,å¯é€‰)
- **ä»»æ„æ–‡æœ¬ç¼–è¾‘å™¨** (VS Code æ¨èé…åˆ CFG æ’ä»¶)

### 2. ä¸‹è½½ cfggen

ä» [GitHub Releases](https://github.com/stallboy/cfggen/releases) ä¸‹è½½é¢„ç¼–è¯‘çš„ `cfggen.jar`ã€‚

æˆ–è€…ä»æºç æ„å»ºï¼š

```bash
# ç”Ÿæˆ cfggen.jar
cd D:\work\mygithub\cfggen
genjar.bat
```

ç”Ÿæˆçš„ `cfggen.jar` ä½äºé¡¹ç›®æ ¹ç›®å½•ã€‚

---

## â±ï¸ 5 åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹

### æ­¥éª¤ 1: åˆ›å»ºç¬¬ä¸€ä¸ªé…ç½®ç»“æ„ (1 åˆ†é’Ÿ)

åˆ›å»ºé…ç½®ç›®å½•å’Œå®šä¹‰æ–‡ä»¶:

```bash
# åˆ›å»ºé¡¹ç›®ç›®å½•
mkdir mygame
cd mygame
mkdir config

# åˆ›å»º item æ¨¡å—ç›®å½•
mkdir config\item

# åˆ›å»ºç»“æ„å®šä¹‰æ–‡ä»¶
echo "" > config\item\item.cfg
```

ç¼–è¾‘ `config\item\item.cfg`,å†™å…¥ä»¥ä¸‹å†…å®¹:

```cfg
struct ItemType {
    id:int;           // ç±»å‹ID
    name:str;         // ç±»å‹åç§°
}

struct Reward {
    itemId:int;       // é“å…·ID
    count:int;        // æ•°é‡
}

table itemtype[id] (enum='name') {
    id:int;
    name:str;
}

table item[id] {
    id:int;
    name:str;
    type:str ->itemtype.name;  // å¤–é”®å¼•ç”¨
    price:int;
    description:text;
    rewards:list<Reward>;
}
```

**è¯´æ˜**:
- `struct`: å®šä¹‰å¤æ‚æ•°æ®ç»“æ„
- `table`: å®šä¹‰æ•°æ®è¡¨,`[id]` è¡¨ç¤ºä¸»é”®
- `->itemtype.name`: å¤–é”®å¼•ç”¨,æŒ‡å‘ itemtype è¡¨çš„ name å­—æ®µ
- `list<Reward>`: åˆ—è¡¨ç±»å‹,åŒ…å« Reward ç»“æ„

### æ­¥éª¤ 2: å‡†å¤‡æ•°æ®æ–‡ä»¶ (2 åˆ†é’Ÿ)

#### æ–¹å¼ A: ä½¿ç”¨ Excel (æ¨è)

1. æ‰“å¼€ Excel,åˆ›å»º `item.xlsx`
2. åˆ›å»ºä¸¤ä¸ªå·¥ä½œè¡¨:

**å·¥ä½œè¡¨ 1: `itemtype`**

| id | name |
|----|------|
| 1  | weapon |
| 2  | armor |
| 3  | consumable |

**å·¥ä½œè¡¨ 2: `item`**

| id | name | type | price | description | rewards |
|----|------|------|-------|-------------|---------|
| 1001 | é“å‰‘ | weapon | 100 | ä¸€æŠŠæ™®é€šçš„é“å‰‘ |  |
| 1002 | é’¢ç›¾ | armor | 150 | åšå›ºçš„é’¢ç›¾ |  |
| 2001 | è¡€ç“¶ | consumable | 50 | æ¢å¤50ç‚¹ç”Ÿå‘½å€¼ |  |

å°† `item.xlsx` ä¿å­˜åˆ° `config/` ç›®å½•ã€‚

### æ­¥éª¤ 3: ç”Ÿæˆä»£ç å’Œæ•°æ® (1 åˆ†é’Ÿ)

```bash
# ä» config ç›®å½•æ‰§è¡Œ
cd config
java -jar ../cfggen.jar -datadir . -gen java,dir:../java -gen javadata,file:../java/config.data
```

**ç”Ÿæˆç»“æœ**:
```
mygame/
â”œâ”€â”€ config/              # é…ç½®æºæ–‡ä»¶
â”‚   â””â”€â”€ item/            # item æ¨¡å—
â”‚       â”œâ”€â”€ item.cfg     # ç»“æ„å®šä¹‰
â”‚       â””â”€â”€ item.xlsx    # æ•°æ®æ–‡ä»¶
â”‚
â”œâ”€â”€ java/                # ç”Ÿæˆçš„ä»£ç å’Œæ•°æ®
â”‚   â”œâ”€â”€ config/          # é…ç½®ç±»
â”‚   â”œâ”€â”€ configgen/       # Schema æ¡†æ¶ï¼ˆéœ€è¦å¤åˆ¶ï¼‰
â”‚   â””â”€â”€ config.data      # æ•°æ®æ–‡ä»¶
â”‚
â””â”€â”€ javaload/            # ç”¨æˆ·çš„åŠ è½½ä»£ç 
    â””â”€â”€ LoadConfig.java
```

**è¯´æ˜**:
- `-gen java,dir:../java`: ç”Ÿæˆ Java è®¿é—®ä»£ç åˆ° `../java` ç›®å½•
- `-gen javadata,file:../java/config.data`: ç”ŸæˆäºŒè¿›åˆ¶æ•°æ®æ–‡ä»¶åˆ° `../java/config.data`
- ç”Ÿæˆçš„ä»£ç ä½äº `java/config/` ç›®å½•
- æ•°æ®æ–‡ä»¶ä¸º `java/config.data`

### æ­¥éª¤ 4: å¤åˆ¶ Schema æ¡†æ¶æ–‡ä»¶

ç”Ÿæˆçš„ Java ä»£ç ä¾èµ– Schema æ¡†æ¶æ–‡ä»¶ï¼Œéœ€è¦ä» cfggen æºç å¤åˆ¶è¿™äº›æ–‡ä»¶ï¼š

```bash
# åˆ›å»º configgen/genjava ç›®å½•
mkdir -p java\configgen\genjava

# ä» cfggen æºç å¤åˆ¶ Schema æ¡†æ¶æ–‡ä»¶
cp ../app/src/main/java/configgen/genjava/Schema.java java/configgen/genjava/
cp ../app/src/main/java/configgen/genjava/SchemaBean.java java/configgen/genjava/
cp ../app/src/main/java/configgen/genjava/SchemaCompatibleException.java java/configgen/genjava/
cp ../app/src/main/java/configgen/genjava/SchemaEnum.java java/configgen/genjava/
cp ../app/src/main/java/configgen/genjava/SchemaInterface.java java/configgen/genjava/
cp ../app/src/main/java/configgen/genjava/SchemaList.java java/configgen/genjava/
cp ../app/src/main/java/configgen/genjava/SchemaMap.java java/configgen/genjava/
cp ../app/src/main/java/configgen/genjava/SchemaPrimitive.java java/configgen/genjava/
cp ../app/src/main/java/configgen/genjava/SchemaRef.java java/configgen/genjava/
cp ../app/src/main/java/configgen/genjava/BinaryToText.java java/configgen/genjava/
cp ../app/src/main/java/configgen/genjava/ConfigErr.java java/configgen/genjava/
cp ../app/src/main/java/configgen/genjava/ConfigInput.java java/configgen/genjava/
cp ../app/src/main/java/configgen/genjava/ConfigOutput.java java/configgen/genjava/
```

**éœ€è¦å¤åˆ¶çš„æ–‡ä»¶**ï¼ˆå…±13ä¸ªï¼‰:
- Schema.java
- SchemaBean.java, SchemaEnum.java, SchemaInterface.java
- SchemaList.java, SchemaMap.java, SchemaPrimitive.java, SchemaRef.java
- ConfigInput.java, ConfigOutput.java
- BinaryToText.java, ConfigErr.java, SchemaCompatibleException.java

è¿™äº›æ–‡ä»¶æä¾›äº† Schema å…¼å®¹æ€§æ£€æŸ¥å’Œæ•°æ®åŠ è½½çš„æ ¸å¿ƒåŠŸèƒ½ã€‚

### æ­¥éª¤ 5: é…ç½® Gradle æ„å»º

åˆ›å»º `build.gradle` æ–‡ä»¶ï¼š

```groovy
plugins {
    id 'application'
}

repositories {
    mavenCentral()
}

java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(21)
    }
}

sourceSets {
    main {
        java {
            srcDirs = ['java', 'javaload']
        }
    }
}

compileJava {
    options.encoding = "UTF-8"
}

application {
    mainClass = 'LoadConfig'
}

jar {
    manifest {
        attributes 'Main-Class': 'LoadConfig'
    }
}
```

### æ­¥éª¤ 6: ä½¿ç”¨ç”Ÿæˆçš„ä»£ç  (1 åˆ†é’Ÿ)

åˆ›å»º `javaload/LoadConfig.java`:

```java
import config.ConfigCodeSchema;
import config.ConfigMgr;
import config.ConfigMgrLoader;
import configgen.genjava.ConfigInput;
import configgen.genjava.Schema;
import configgen.genjava.SchemaCompatibleException;

import java.io.DataInputStream;
import java.io.BufferedInputStream;
import java.io.FileInputStream;

public class LoadConfig {
    public static void main(String[] args) throws Exception {
        // 1. æ£€æŸ¥ Schema å…¼å®¹æ€§
        Schema codeSchema = ConfigCodeSchema.getCodeSchema();

        try (ConfigInput input = new ConfigInput(
                new DataInputStream(new BufferedInputStream(
                    new FileInputStream("java/config.data"))))) {

            // 2. è¯»å–æ•°æ®æ–‡ä»¶çš„ Schema
            Schema dataSchema = Schema.create(input);

            // 3. æ£€æŸ¥å…¼å®¹æ€§
            if (!codeSchema.compatible(dataSchema)) {
                throw new SchemaCompatibleException("schema not compatible");
            }

            // 4. åŠ è½½é…ç½®æ•°æ®
            ConfigMgr mgr = ConfigMgrLoader.load(input);
            ConfigMgr.setMgr(mgr);
        }

        // 5. ä½¿ç”¨é…ç½®
        config.item.Item item = config.item.Item.get(1001);
        System.out.println(item.getName());   // è¾“å‡º: é“å‰‘
        System.out.println(item.getPrice());  // è¾“å‡º: 100

        // 6. éå†æ‰€æœ‰é“å…·
        for (config.item.Item i : config.item.Item.all()) {
            System.out.println(i.getId() + ": " + i.getName());
        }
    }
}
```

**è¿è¡Œç¨‹åº**:
```bash
# ç¼–è¯‘
gradle build

# è¿è¡Œ
gradle run

# æˆ–ç›´æ¥è¿è¡Œ JAR
java -jar build/libs/mygame.jar
```

**API è¯´æ˜**:
- `ConfigCodeSchema.getCodeSchema()`: è·å–ä»£ç å®šä¹‰çš„ Schema
- `Schema.create(input)`: ä»æ•°æ®æ–‡ä»¶è¯»å– Schema
- `codeSchema.compatible(dataSchema)`: æ£€æŸ¥å…¼å®¹æ€§
- `ConfigMgrLoader.load(input)`: åŠ è½½é…ç½®æ•°æ®
- `Item.get(id)`: æ ¹æ®ä¸»é”®è·å–è®°å½•
- `Item.all()`: è·å–æ‰€æœ‰è®°å½•çš„é›†åˆ

---

## ğŸ¯ ä¸‹ä¸€æ­¥å­¦ä¹ 

æ­å–œ!æ‚¨å·²ç»å®Œæˆäº†ç¬¬ä¸€ä¸ªé…ç½®ç¤ºä¾‹ã€‚æ¥ä¸‹æ¥å¯ä»¥å­¦ä¹ :

### 1ï¸âƒ£ æ·±å…¥ç»“æ„å®šä¹‰

- [ç»“æ„å®šä¹‰è¯¦è§£](./03.schema.md) - å­¦ä¹  structã€interfaceã€table çš„å®Œæ•´è¯­æ³•
- [ä¸»é”®ã€æšä¸¾ã€å¤–é”®](./04.key.md) - ç†è§£æ•°æ®å…³è”å’Œå¼•ç”¨
- [æ˜ å°„åˆ°è¡¨æ ¼](./05.tabularMapping.md) - Excel å•å…ƒæ ¼å¦‚ä½•æ˜ å°„åˆ°å¤æ‚æ•°æ®ç»“æ„

### 2ï¸âƒ£ é«˜çº§åŠŸèƒ½

- [æ ‡ç­¾ç³»ç»Ÿ](./06.tag.md) - å®¢æˆ·ç«¯/æœåŠ¡å™¨æ•°æ®åˆ†ç¦»
- [å›½é™…åŒ–æ”¯æŒ](./10.i18n.md) - å¤šè¯­è¨€é…ç½®
- [AI ç”Ÿæˆé…ç½®](../aigen/) - ä½¿ç”¨ AI è‡ªåŠ¨ç”Ÿæˆé…ç½®æ•°æ®

### 3ï¸âƒ£ å®è·µç¤ºä¾‹

æŸ¥çœ‹ `example/` ç›®å½•ä¸‹çš„å®Œæ•´ç¤ºä¾‹:

- `example/config/` - é…ç½®å®šä¹‰å’Œæ•°æ®æ–‡ä»¶
- `example/genjava.bat` - ç”Ÿæˆ Java ä»£ç å’Œå¤åˆ¶ Schema æ¡†æ¶çš„å®Œæ•´è„šæœ¬
- `example/javaload/LoadConfig.java` - é…ç½®åŠ è½½ç¤ºä¾‹
- `example/build.gradle` - Gradle æ„å»ºé…ç½®ç¤ºä¾‹

---

## ğŸ’¡ æœ€ä½³å®è·µ

### é¡¹ç›®ç»“æ„æ¨è

```
mygame/
â”œâ”€â”€ config/              # é…ç½®æºæ–‡ä»¶
â”‚   â”œâ”€â”€ gen_client.bat   # å®¢æˆ·ç«¯ä»£ç ç”Ÿæˆè„šæœ¬
â”‚   â”œâ”€â”€ gen_server.bat   # æœåŠ¡å™¨ä»£ç ç”Ÿæˆè„šæœ¬
â”‚   â”‚
â”‚   â”œâ”€â”€ item/            # item æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ item.cfg     # æ¨¡å—ç»“æ„å®šä¹‰
â”‚   â”‚   â””â”€â”€ item.xlsx    # æ¨¡å—æ•°æ®æ–‡ä»¶
â”‚   â”‚
â”‚   â”œâ”€â”€ task/            # task æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ task.cfg
â”‚   â”‚   â””â”€â”€ task_ä»»åŠ¡.xlsx
â”‚   â”‚
â”‚   â””â”€â”€ equip/           # equip æ¨¡å—
â”‚       â”œâ”€â”€ equip.cfg
â”‚       â””â”€â”€ equip.xlsx
â”‚
â”œâ”€â”€ java/                # ç”Ÿæˆçš„ Java ä»£ç 
â”‚   â”œâ”€â”€ config/          # é…ç½®ç±»
â”‚   â”œâ”€â”€ configgen/       # Schema æ¡†æ¶
â”‚   â””â”€â”€ config.data      # æ•°æ®æ–‡ä»¶
â”‚
â”œâ”€â”€ javaload/            # ç”¨æˆ·çš„åŠ è½½ä»£ç 
â”œâ”€â”€ lua/                 # ç”Ÿæˆçš„ Lua ä»£ç 
â”œâ”€â”€ cs/                  # ç”Ÿæˆçš„ C# ä»£ç 
â””â”€â”€ build.gradle         # Gradle æ„å»ºé…ç½®
```

**è¯´æ˜**:
- æ¯ä¸ªæ¨¡å—ç›®å½•åŒ…å«è‡ªå·±çš„ `.cfg` å®šä¹‰æ–‡ä»¶
- ç”Ÿæˆè„šæœ¬(`gen_client.bat`ç­‰)æ”¾åœ¨ `config/` ç›®å½•ä¸‹
- ç”Ÿæˆçš„ä»£ç æ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•çš„å¯¹åº”è¯­è¨€ç›®å½•ä¸­
- `java/configgen/` ç›®å½•éœ€è¦ä» cfggen æºç å¤åˆ¶ Schema æ¡†æ¶æ–‡ä»¶

### å·¥ä½œæµç¨‹æ¨è

1. **å®šä¹‰ç»“æ„**: åœ¨æ¨¡å—ç›®å½•çš„ `.cfg` æ–‡ä»¶ä¸­å®šä¹‰æ•°æ®ç»“æ„
2. **ç¼–è¾‘æ•°æ®**: åœ¨æ¨¡å—ç›®å½•ä¸­ä½¿ç”¨ Excel å¡«å†™æ•°æ®
3. **éªŒè¯æ•°æ®**: ä½¿ç”¨ `cfggen` éªŒè¯æ•°æ®ä¸€è‡´æ€§
4. **ç”Ÿæˆä»£ç **: è¿è¡Œ `config/gen_client.bat` ç”Ÿæˆç¨‹åºè®¿é—®ä»£ç 
5. **ç‰ˆæœ¬æ§åˆ¶**: å°†é…ç½®æ–‡ä»¶çº³å…¥ Git ç®¡ç†
6. **æŒç»­é›†æˆ**: è‡ªåŠ¨åŒ–ç”Ÿæˆå’Œæµ‹è¯•æµç¨‹

### å‘½åè§„èŒƒ

- **è¡¨å**: å°å†™,å¦‚ `item`, `task`
- **å­—æ®µå**: å°é©¼å³°,å¦‚ `itemName`, `maxCount`
- **å¸¸é‡**: å…¨å¤§å†™,å¦‚ `MAX_LEVEL`
- **å¤–é”®**: ä½¿ç”¨å…³è”è¡¨å,å¦‚ `itemId`, `taskId`

---

## â“ å¸¸è§é—®é¢˜

### Q: Excel æ–‡ä»¶æ”¾åœ¨å“ªé‡Œ?

**A**: æœ‰ä¸¤ç§æ–¹å¼:
1. ç›´æ¥æ”¾åœ¨ `config/` ç›®å½•: `config/item.xlsx`
2. æ”¾åœ¨æ¨¡å—ç›®å½•: `config/item/item_é“å…·.xlsx`

### Q: å¦‚ä½•å¤„ç†å¤šè¯­è¨€?

**A**:
1. å°†å­—æ®µç±»å‹ä» `str` æ”¹ä¸º `text`
2. è¿è¡Œå›½é™…åŒ–ç”Ÿæˆå‘½ä»¤
3. ç¿»è¯‘ç”Ÿæˆçš„ CSV æ–‡ä»¶
4. é‡æ–°ç”Ÿæˆä»£ç 

è¯¦è§: [å›½é™…åŒ–æ”¯æŒ](./10.i18n.md)

### Q: å¤–é”®å¼•ç”¨å¤±è´¥æ€ä¹ˆåŠ?

**A**:
1. æ£€æŸ¥è¢«å¼•ç”¨çš„è¡¨å’Œå­—æ®µæ˜¯å¦å­˜åœ¨
2. æ£€æŸ¥æ•°æ®ç±»å‹æ˜¯å¦åŒ¹é…
3. ä½¿ç”¨ `-gen` å‘½ä»¤çš„éªŒè¯åŠŸèƒ½æŸ¥çœ‹è¯¦ç»†é”™è¯¯

### Q: å¦‚ä½•å®ç°å®¢æˆ·ç«¯/æœåŠ¡å™¨æ•°æ®åˆ†ç¦»?

**A**:
1. åœ¨å­—æ®µæˆ–è¡¨ä¸Šæ·»åŠ æ ‡ç­¾,å¦‚ `(client)`
2. ç”Ÿæˆæ—¶ä½¿ç”¨è¿‡æ»¤: `-gen lua,own:client`
3. æœåŠ¡å™¨ç«¯ä½¿ç”¨: `-gen java,own:server`

è¯¦è§: [æ ‡ç­¾ç³»ç»Ÿ](./06.tag.md)

---

## ğŸ“ è·å–å¸®åŠ©

- ğŸ“– [å®Œæ•´æ–‡æ¡£](https://stallboy.github.io/cfggen)
- ğŸ’¬ [GitHub Issues](https://github.com/stallboy/cfggen/issues)
- ğŸ® [é…ç½®ç¼–è¾‘å™¨](../cfgeditor/) - å¯è§†åŒ–é…ç½®ç¼–è¾‘å·¥å…·

---

## ğŸ‰ æ‚¨å·²ç»å‡†å¤‡å¥½äº†!

ç°åœ¨æ‚¨å·²ç»æŒæ¡äº† cfggen çš„åŸºæœ¬ç”¨æ³•,å¯ä»¥å¼€å§‹æ„å»ºè‡ªå·±çš„æ¸¸æˆé…ç½®ç³»ç»Ÿäº†ã€‚

**å»ºè®®ä¸‹ä¸€æ­¥**:
1. æŸ¥çœ‹ `example/` ç›®å½•ä¸‹çš„å®Œæ•´ç¤ºä¾‹
2. é˜…è¯» [ç»“æ„å®šä¹‰è¯¦è§£](./03.schema.md)
3. å°è¯•ä½¿ç”¨ [é…ç½®ç¼–è¾‘å™¨](../cfgeditor/) å¯è§†åŒ–ç¼–è¾‘é…ç½®

ç¥æ‚¨ä½¿ç”¨æ„‰å¿«! ğŸ®
