---
layout: page
title: ç»“æ„å®šä¹‰
parent: é…è¡¨ç³»ç»Ÿ
nav_order: 3
---

# ğŸ—ï¸ ç»“æ„å®šä¹‰
{: .no_toc }

## Table of Contents
{: .no_toc .text-delta }

1. TOC
{:toc}
---

## ğŸ¯ è®¾è®¡ç†å¿µ

CFGæ–‡ä»¶ç»“æ„å®šä¹‰ç³»ç»Ÿæ—¨åœ¨è¡¨è¾¾å¤æ‚çš„æ•°æ®ç»“æ„å’Œå…³ç³»ç½‘ç»œã€‚ç³»ç»Ÿé€šè¿‡ä»¥ä¸‹æ ¸å¿ƒç»„ä»¶æ„å»ºï¼š

```
åŸºç¡€ç±»å‹ï¼ˆint, float, str, bool, long, textï¼‰
    â†“
ç»“æ„ä½“ï¼ˆstructï¼‰èšåˆåŸºç¡€ç±»å‹ï¼Œæ”¯æŒåµŒå¥—
    â†“
å®¹å™¨ç±»å‹ï¼ˆlist, mapï¼‰è¡¨è¾¾é›†åˆæ•°æ®
    â†“
æ¥å£ï¼ˆinterfaceï¼‰å®ç°å¤šæ€è¡Œä¸º
    â†“
æ•°æ®è¡¨ï¼ˆtableï¼‰å­˜å‚¨å…·ä½“æ•°æ®ï¼Œé€šè¿‡ä¸»é”®ã€å”¯ä¸€é”®ã€å¤–é”®å»ºç«‹å…³è”
```

æœ€ç»ˆå½¢æˆä¸€ä¸ªç›¸äº’å…³è”çš„æ•°æ®ç½‘ç»œï¼Œæ”¯æŒå¤æ‚æ¸¸æˆé€»è¾‘çš„é…ç½®ã€‚

## ğŸ§± ç»“æ„ä½“ï¼ˆstructï¼‰

ç»“æ„ä½“ç”¨äºå®šä¹‰å¤åˆæ•°æ®ç±»å‹ï¼Œæ˜¯æ„å»ºå¤æ‚æ•°æ®ç»“æ„çš„åŸºç¡€ã€‚

### è¯­æ³•è§„åˆ™

- **å®šä¹‰æ ¼å¼**ï¼š`struct ç»“æ„ä½“åç§° { å­—æ®µå®šä¹‰ }`
- **å­—æ®µå®šä¹‰**ï¼š`å­—æ®µå:å­—æ®µç±»å‹; // æ³¨é‡Š`
- **å­—æ®µç±»å‹**ï¼š
  - **åŸºç¡€ç±»å‹**ï¼š`bool`, `int`, `float`, `long`, `str`, `text`
  - **èšåˆç±»å‹**ï¼š`struct`, `interface`
  - **å®¹å™¨ç±»å‹**ï¼š`list<ç±»å‹>`, `map<é”®ç±»å‹,å€¼ç±»å‹>`

### å¤–é”®å…³è”

- **å•å‘å¤–é”®ï¼ˆ->ï¼‰**ï¼šæŒ‡å‘è¡¨çš„ä¸»é”®æˆ–å”¯ä¸€é”®
  - æ ¼å¼ï¼š`å­—æ®µç±»å‹ ->è¡¨å`ï¼ˆæŒ‡å‘ä¸»é”®ï¼‰
  - æ ¼å¼ï¼š`å­—æ®µç±»å‹ ->è¡¨å[å”¯ä¸€é”®]`ï¼ˆæŒ‡å‘å”¯ä¸€é”®ï¼‰
- **å¤šå‘å¤–é”®ï¼ˆ=>ï¼‰**ï¼šæŒ‡å‘è¡¨çš„ä»»æ„å­—æ®µï¼Œç”Ÿæˆåå‘å¼•ç”¨åˆ—è¡¨
  - æ ¼å¼ï¼š`å­—æ®µç±»å‹ =>è¡¨å[å­—æ®µå]`
- **ç‹¬ç«‹å¤–é”®**ï¼š`->å¤–é”®å:[å­—æ®µåˆ—è¡¨] ->|=> ç›®æ ‡è¡¨`

> è¯¦ç»†å¤–é”®è¯´æ˜è¯·å‚è€ƒï¼š[ä¸»é”®ã€æšä¸¾ã€å¤–é”®](../04.key/)

### å®¹å™¨ç±»å‹å¤–é”®

- **listå¤–é”®**ï¼šåˆ—è¡¨ä¸­æ¯ä¸ªå…ƒç´ çš„å¤–é”®
- **mapå¤–é”®**ï¼šmapä¸­æ¯ä¸ªvalueçš„å¤–é”®ï¼ˆä¸æ”¯æŒkeyçš„å¤–é”®ï¼‰

### ç¤ºä¾‹

```cfg
struct Range {
	rmin:int; // æœ€å°å€¼
	rmax:int; // æœ€å¤§å€¼
}

struct RewardItem {
	chance:int; // æ‰è½æ¦‚ç‡
	itemids:list<int> ->item.item (fix=2); // æ‰è½ç‰©å“åˆ—è¡¨ï¼Œæ¯ä¸ªç‰©å“æŒ‡å‘itemè¡¨
	range:Range; // æ•°é‡èŒƒå›´ï¼ˆåµŒå¥—ç»“æ„ï¼‰
}

struct Time (sep=':'){
    hour:int;   // å°æ—¶
    minute:int; // åˆ†é’Ÿ
    second:int; // ç§’
}
```

**ç‰¹æ€§è¯´æ˜ï¼š**
- `Range`ï¼šåŸºç¡€ç»“æ„ä½“ï¼Œå®šä¹‰æ•°å€¼èŒƒå›´
- `RewardItem`ï¼šå¤æ‚ç»“æ„ä½“ï¼ŒåŒ…å«åˆ—è¡¨å¤–é”®å’ŒåµŒå¥—ç»“æ„
- `Time`ï¼šä½¿ç”¨`(sep=':')`å±æ€§ï¼Œæ”¯æŒExcelä¸­ä»¥å†’å·åˆ†éš”çš„æ—¶é—´æ ¼å¼

## ğŸ¯ æ¥å£ï¼ˆinterfaceï¼‰

æ¥å£ç”¨äºå®šä¹‰å¤šæ€è¡Œä¸ºï¼Œæ”¯æŒå¤šç§å®ç°ç±»ï¼Œå¸¸ç”¨äºæ¸¸æˆé€»è¾‘çš„æ¡ä»¶åˆ¤æ–­å’Œå…¬å¼è®¡ç®—ã€‚

### æ ¸å¿ƒå±æ€§

- **enumRef**ï¼šæŒ‡å‘æšä¸¾è¡¨ï¼Œè¯¥è¡¨åŒ…å«æ¥å£æ‰€æœ‰å®ç°ç±»çš„ä¿¡æ¯
  - ä½œç”¨ï¼šè®©ç­–åˆ’åœ¨Excelä¸­é€šè¿‡ä¸‹æ‹‰èœå•é€‰æ‹©å®ç°ç±»ï¼Œæ— éœ€æŸ¥çœ‹CFGæ–‡ä»¶
  - è¦æ±‚ï¼šæšä¸¾è¡¨å¿…é¡»åŒ…å«å®ç°ç±»åç§°ï¼Œå¯åŒ…å«IDå’Œå…¶ä»–ä¿¡æ¯

- **defaultImpl**ï¼šæŒ‡å®šé»˜è®¤å®ç°ç±»
  - ä½œç”¨ï¼šExcelä¸­å¯ä¸æ˜¾å¼é…ç½®æ¥å£å­—æ®µï¼Œç³»ç»Ÿè‡ªåŠ¨ä½¿ç”¨é»˜è®¤å®ç°
  - ç‰¹æ®Šç”¨æ³•ï¼šé…åˆ`pack`å±æ€§ï¼Œå½“é»˜è®¤å®ç°åªåŒ…å«å•ä¸ªæ•°å­—å­—æ®µæ—¶ï¼ŒExcelä¸­å¯ç›´æ¥å¡«å†™æ•°å­—

- **pack**ï¼šæ‰“åŒ…å±æ€§ï¼Œç®€åŒ–Excelé…ç½®

### ç¤ºä¾‹

```cfg
interface completecondition (enumRef='completeconditiontype') {
	struct KillMonster {
		monsterid:int ->npc.monster; // æ€ªç‰©IDï¼Œå¤–é”®æŒ‡å‘npcè¡¨
		count:int;                   // éœ€è¦å‡»æ€çš„æ•°é‡
	}

	struct TalkNpc {
		npcid:int ->npc.npcid;       // NPC IDï¼Œå¤–é”®æŒ‡å‘npcè¡¨
	}

	struct ConditionAnd {
		cond1:task.completecondition (pack); // æ¡ä»¶1ï¼Œé€’å½’å¼•ç”¨
		cond2:task.completecondition (pack); // æ¡ä»¶2ï¼Œé€’å½’å¼•ç”¨
	}

	struct CollectItem {
		itemid:int ->item.item;      // ç‰©å“IDï¼Œå¤–é”®æŒ‡å‘itemè¡¨
		count:int;                   // éœ€è¦æ”¶é›†çš„æ•°é‡
	}
}

interface taskexp (enumRef='taskexptype', defaultImpl='ConstValue', pack) {
    struct ByLevel { // åŸºäºç©å®¶ç­‰çº§çš„å…¬å¼
		levelcoef:float; // ç­‰çº§ç³»æ•°
		value:int;       // åŸºç¡€å€¼
	}

	struct ByServerUpDay { // åŸºäºæœåŠ¡å™¨å¤©æ•°çš„å…¬å¼
		updaycoef1:float; // å¤©æ•°ç³»æ•°1
		updaycoef2:float; // å¤©æ•°ç³»æ•°2
		value:int;        // åŸºç¡€å€¼
	}

	struct ConstValue { // å›ºå®šå€¼å…¬å¼
	    value:int;      // å›ºå®šç»éªŒå€¼
	}
}
```

**è®¾è®¡ä¼˜åŠ¿ï¼š**
- **å¯æ‰©å±•æ€§**ï¼šæ–°å¢ä»»åŠ¡å®Œæˆæ¡ä»¶åªéœ€æ·»åŠ æ–°çš„structå®ç°
- **æ˜“ç”¨æ€§**ï¼šç­–åˆ’é€šè¿‡ä¸‹æ‹‰èœå•é€‰æ‹©ï¼Œæ— éœ€äº†è§£æŠ€æœ¯ç»†èŠ‚
- **çµæ´»æ€§**ï¼šæ”¯æŒé€’å½’ç»„åˆï¼Œå¯æ„å»ºå¤æ‚æ¡ä»¶æ ‘
- **ç®€åŒ–é…ç½®**ï¼š`taskexp`æ¥å£æ”¯æŒç›´æ¥å¡«å†™æ•°å­—è¡¨ç¤ºå›ºå®šå€¼

## ğŸ“Š æ•°æ®è¡¨ï¼ˆtableï¼‰

æ•°æ®è¡¨æ˜¯å®é™…å­˜å‚¨é…ç½®æ•°æ®çš„å®¹å™¨ï¼Œæ”¯æŒç´¢å¼•ã€çº¦æŸå’Œå¤šæ€å­—æ®µã€‚

### è¡¨ç»“æ„å®šä¹‰

- **ä¸»é”®**ï¼šè¡¨ååçš„`[]`å†…å®šä¹‰ä¸»é”®å­—æ®µ
- **è¡¨å±æ€§**ï¼šä¸»é”®åçš„`()`å†…å®šä¹‰è¡¨çº§å±æ€§
- **å”¯ä¸€é”®**ï¼š`{}`å†…ä»¥`[å­—æ®µå]`å¼€å¤´çš„è¡Œå®šä¹‰å”¯ä¸€é”®
- **å­—æ®µå®šä¹‰**ï¼šä¸structè¯­æ³•ç›¸åŒ

> è¯¦ç»†ä¸»é”®ã€å”¯ä¸€é”®è¯´æ˜è¯·å‚è€ƒï¼š[ä¸»é”®ã€æšä¸¾ã€å¤–é”®](../04.key/)

### è¡¨çº§å±æ€§

- **enum**ï¼šæŒ‡å®šæšä¸¾å­—æ®µï¼Œè¯¥è¡¨ä½œä¸ºæšä¸¾è¡¨ä½¿ç”¨
  - ä½œç”¨ï¼šExcelä¸­è¯¥åˆ—ç”±ç¨‹åºå‘˜å¡«å†™ï¼Œæ¯è¡Œéƒ½å¿…é¡»æœ‰å€¼
  - ç”¨é€”ï¼šé…åˆinterfaceçš„enumRefå±æ€§

- **entry**ï¼šæŒ‡å®šå…¥å£å­—æ®µï¼Œç”Ÿæˆé™æ€è®¿é—®ä»£ç 
  - ä½œç”¨ï¼šExcelä¸­è¯¥åˆ—ç”±ç¨‹åºå‘˜å¡«å†™ï¼Œåªæœ‰ç‰¹å®šè¡Œéœ€è¦å€¼
  - ç”¨é€”ï¼šç¨‹åºä»£ç ä¸­é€šè¿‡é™æ€æˆå‘˜ç›´æ¥è®¿é—®ç‰¹å®šè¡Œ

### ç¤ºä¾‹

```cfg
table completeconditiontype[id] (enum='name') {
	id:int;   // ä»»åŠ¡å®Œæˆæ¡ä»¶ç±»å‹ID
	name:str; // ç¨‹åºç”¨åç§°ï¼ˆå¿…é¡»åŒ…å«completeconditionæ¥å£çš„æ‰€æœ‰å®ç°ç±»åï¼‰
}

table taskexptype[id] (enum='name') {
	id:int;   // ç»éªŒå…¬å¼ç±»å‹ID
	name:str; // ç¨‹åºç”¨åç§°ï¼ˆå¿…é¡»åŒ…å«taskexpæ¥å£çš„æ‰€æœ‰å®ç°ç±»åï¼‰
}

table task[taskid] (entry='entry') {
	[nexttask];                           // å®šä¹‰å”¯ä¸€é”®
	taskid:int ->task.taskextraexp (nullable); // ä»»åŠ¡IDï¼Œå¤–é”®ï¼ˆå¯ç©ºï¼‰
	entry:str;                           // å…¥å£æ ‡è¯†ï¼Œç¨‹åºä»£ç ç›´æ¥è®¿é—®
	text:text;                           // å›½é™…åŒ–æ–‡æœ¬
	nexttask:int ->task (nullable);      // ä¸‹ä¸€ä¸ªä»»åŠ¡IDï¼Œå¤–é”®ï¼ˆå¯ç©ºï¼‰
	completecondition:task.completecondition; // ä»»åŠ¡å®Œæˆæ¡ä»¶ï¼ˆå¤šæ€æ¥å£ï¼‰
	exp:taskexp (mustFill);              // ç»éªŒå¥–åŠ±å…¬å¼ï¼ˆå¤šæ€æ¥å£ï¼Œå¿…é¡»å¡«å†™ï¼‰
	rewardItems:list<RewardItem> (block=1); // ç‰©å“å¥–åŠ±åˆ—è¡¨
	time:Time;                           // æ—¶é—´é…ç½®
}
```

**è¡¨è®¾è®¡è¯´æ˜ï¼š**
- **completeconditiontype**ï¼šæšä¸¾è¡¨ï¼Œå®šä¹‰ä»»åŠ¡å®Œæˆæ¡ä»¶ç±»å‹
- **taskexptype**ï¼šæšä¸¾è¡¨ï¼Œå®šä¹‰ç»éªŒå…¬å¼ç±»å‹
- **task**ï¼šä¸»ä»»åŠ¡è¡¨ï¼ŒåŒ…å«å¤æ‚çš„æ•°æ®ç»“æ„å’Œå…³è”å…³ç³»
- **å”¯ä¸€é”®**ï¼š`[nexttask]`ä¼šç”Ÿæˆ`GetByNextTask`è®¿é—®æ–¹æ³•
- **å¤šæ€å­—æ®µ**ï¼š`completecondition`å’Œ`exp`å­—æ®µæ”¯æŒå¤šç§å®ç°

## ğŸ› ï¸ å­—æ®µå±æ€§

å­—æ®µå¯ä»¥é…ç½®å¤šç§å±æ€§æ¥æ§åˆ¶æ•°æ®éªŒè¯å’Œç”Ÿæˆè¡Œä¸ºã€‚

### å¸¸ç”¨å±æ€§

| å±æ€§ | ç”¨é€” | é€‚ç”¨ç±»å‹ |
|------|------|----------|
| `nullable` | å…è®¸å­—æ®µä¸ºç©º | æ‰€æœ‰ç±»å‹ |
| `mustFill` | å¿…é¡»å¡«å†™ï¼Œä¸èƒ½ä¸ºç©º | æ‰€æœ‰ç±»å‹ |
| `fix=N` | æ˜ å°„ï¼Œå›ºå®šé•¿åº¦ï¼ŒNä¸ºå…·ä½“æ•°å€¼ | listç±»å‹ |
| `block=N` | æ˜ å°„... | ... |
| `pack` | æ˜ å°„... | ... |
| `sep='åˆ†éš”ç¬¦'`| æ˜ å°„... | ... |

> è¯¦ç»†æ˜ å°„è§„åˆ™è¯·å‚è€ƒï¼š[æ˜ å°„åˆ°è¡¨æ ¼](../05.tabularMapping/)

### å±æ€§ç¤ºä¾‹

```cfg
struct Example {
	optionalField:int (nullable);     // å¯ç©ºå­—æ®µ
	requiredField:str (mustFill);     // å¿…é¡»å¡«å†™
	fixedList:list<int> (fix=3);      // å›ºå®š3ä¸ªå…ƒç´ çš„åˆ—è¡¨
	blockList:list<Item> (block=2);   // å—å¤§å°ä¸º2çš„åˆ—è¡¨
}
```

## ğŸ“‹ å®Œæ•´ç¤ºä¾‹ï¼šä»»åŠ¡ç³»ç»Ÿ

ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®Œæ•´çš„ä»»åŠ¡ç³»ç»Ÿé…ç½®ï¼Œå±•ç¤ºäº†å„ç»„ä»¶å¦‚ä½•ååŒå·¥ä½œï¼š

```cfg
// åŸºç¡€æ•°æ®ç»“æ„
struct Range {
	rmin:int; // æœ€å°å€¼
	rmax:int; // æœ€å¤§å€¼
}

struct RewardItem {
	chance:int; // æ‰è½æ¦‚ç‡
	itemids:list<int> ->item.item (fix=2); // æ‰è½ç‰©å“
	range:Range; // æ•°é‡èŒƒå›´
}

struct Time (sep=':'){
    hour:int;   // å°æ—¶
    minute:int; // åˆ†é’Ÿ
    second:int; // ç§’
}

// å¤šæ€æ¥å£å®šä¹‰
interface completecondition (enumRef='completeconditiontype') {
	struct KillMonster {
		monsterid:int ->npc.monster; // æ€ªç‰©ID
		count:int;                   // å‡»æ€æ•°é‡
	}

	struct TalkNpc {
		npcid:int ->npc.npcid;       // NPC ID
	}

	struct ConditionAnd {
		cond1:task.completecondition (pack); // æ¡ä»¶1
		cond2:task.completecondition (pack); // æ¡ä»¶2
	}

	struct CollectItem {
		itemid:int ->item.item;      // ç‰©å“ID
		count:int;                   // æ”¶é›†æ•°é‡
	}
}

interface taskexp (enumRef='taskexptype', defaultImpl='ConstValue', pack) {
    struct ByLevel { // ç­‰çº§ç›¸å…³å…¬å¼
		levelcoef:float; // ç­‰çº§ç³»æ•°
		value:int;       // åŸºç¡€å€¼
	}

	struct ByServerUpDay { // æœåŠ¡å™¨å¤©æ•°ç›¸å…³
		updaycoef1:float; // å¤©æ•°ç³»æ•°1
		updaycoef2:float; // å¤©æ•°ç³»æ•°2
		value:int;        // åŸºç¡€å€¼
	}

	struct ConstValue { // å›ºå®šå€¼
	    value:int;      // å›ºå®šç»éªŒ
	}
}

// æšä¸¾è¡¨
table completeconditiontype[id] (enum='name') {
	id:int;   // ç±»å‹ID
	name:str; // å®ç°ç±»åç§°
}

table taskexptype[id] (enum='name') {
	id:int;   // å…¬å¼ç±»å‹ID
	name:str; // å®ç°ç±»åç§°
}

// ä¸»ä»»åŠ¡è¡¨
table task[taskid] (entry='entry') {
	[nexttask];                           // å”¯ä¸€é”®ï¼šä¸‹ä¸€ä¸ªä»»åŠ¡
	taskid:int ->task.taskextraexp (nullable); // ä»»åŠ¡ID
	entry:str;                           // å…¥å£æ ‡è¯†
	text:text;                           // ä»»åŠ¡æ–‡æœ¬
	nexttask:int ->task (nullable);      // ä¸‹ä¸€ä¸ªä»»åŠ¡
	completecondition:task.completecondition; // å®Œæˆæ¡ä»¶
	exp:taskexp (mustFill);              // ç»éªŒå¥–åŠ±
	rewardItems:list<RewardItem> (block=1); // ç‰©å“å¥–åŠ±
	time:Time;                           // æ—¶é—´é…ç½®
}
```

## ğŸ“– å¿«é€Ÿå‚è€ƒ

### è¯­æ³•é€ŸæŸ¥

| æ„é€  | è¯­æ³• | ç”¨é€” |
|------|------|------|
| ç»“æ„ä½“ | `struct åç§° { å­—æ®µ:ç±»å‹; }` | å®šä¹‰å¤åˆæ•°æ®ç±»å‹ |
| æ¥å£ | `interface åç§° { struct å®ç°ç±» { ... } }` | å®šä¹‰å¤šæ€è¡Œä¸º |
| æ•°æ®è¡¨ | `table è¡¨å[ä¸»é”®] { [å”¯ä¸€é”®]; å­—æ®µ:ç±»å‹; }` | å­˜å‚¨é…ç½®æ•°æ® |
| å¤–é”® | `å­—æ®µ:ç±»å‹ ->ç›®æ ‡è¡¨` | å»ºç«‹è¡¨é—´å…³è” |
| å¤šå‘å¤–é”® | `å­—æ®µ:ç±»å‹ =>ç›®æ ‡è¡¨[å­—æ®µ]` | å»ºç«‹åå‘å¼•ç”¨ |

### å±æ€§é€ŸæŸ¥

| å±æ€§ | ä½ç½® | ç”¨é€” |
|------|------|------|
| `enumRef='è¡¨å'` | interface | æŒ‡å®šæšä¸¾è¡¨ |
| `defaultImpl='ç±»å'` | interface | æŒ‡å®šé»˜è®¤å®ç° |
| `enum='å­—æ®µå'` | table | æŒ‡å®šæšä¸¾å­—æ®µ |
| `entry='å­—æ®µå'` | table | æŒ‡å®šå…¥å£å­—æ®µ |
| `nullable` | å­—æ®µ | å…è®¸ä¸ºç©º |
| `mustFill` | å­—æ®µ | å¿…é¡»å¡«å†™ |
| `fix=N` | æ˜ å°„... | ... |
| `block=N` | æ˜ å°„... | ... |
| `pack` | æ˜ å°„... | ... |
| `sep='åˆ†éš”ç¬¦'` | æ˜ å°„... | ... |

### ç±»å‹ç³»ç»Ÿ

| ç±»å‹åˆ†ç±» | å…·ä½“ç±»å‹ | æè¿° |
|----------|----------|------|
| åŸºç¡€ç±»å‹ | `bool`, `int`, `float`, `long`, `str`, `text` | åŸºæœ¬æ•°æ®ç±»å‹ |
| å®¹å™¨ç±»å‹ | `list<T>`, `map<K,V>` | é›†åˆæ•°æ®ç±»å‹ |
| èšåˆç±»å‹ | `struct`, `interface` | å¤åˆæ•°æ®ç±»å‹ |
| å¼•ç”¨ | `->è¡¨å`,`->è¡¨å[å”¯ä¸€é”®]`, `=>è¡¨å[å­—æ®µ]` | è¡¨é—´å…³è” |

