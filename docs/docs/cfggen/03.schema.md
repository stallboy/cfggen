---
layout: page
title: ç»“æ„å®šä¹‰
parent: é…è¡¨ç³»ç»Ÿ
nav_order: 3
---

# ğŸ—ï¸ ç»“æ„å®šä¹‰
{: .no_toc }

## Table of Contents
{: .no_toc .text-delta }

1. TOC
{:toc}
---

## ğŸ¯ è®¾è®¡ç†å¿µ

CFGæ–‡ä»¶ç»“æ„å®šä¹‰ç³»ç»Ÿæ—¨åœ¨è¡¨è¾¾å¤æ‚çš„æ•°æ®ç»“æ„å’Œå…³ç³»ç½‘ç»œã€‚ç³»ç»Ÿé€šè¿‡ä»¥ä¸‹æ ¸å¿ƒç»„ä»¶æ„å»ºï¼š

```
åŸºç¡€ç±»å‹ï¼ˆint, float, str, bool, long, textï¼‰
    â†“
ç»“æ„ä½“ï¼ˆstructï¼‰èšåˆåŸºç¡€ç±»å‹ï¼Œæ”¯æŒåµŒå¥—
    â†“
å®¹å™¨ç±»å‹ï¼ˆlist, mapï¼‰è¡¨è¾¾é›†åˆæ•°æ®
    â†“
æ¥å£ï¼ˆinterfaceï¼‰å®ç°å¤šæ€è¡Œä¸º
    â†“
æ•°æ®è¡¨ï¼ˆtableï¼‰å­˜å‚¨å…·ä½“æ•°æ®ï¼Œé€šè¿‡ä¸»é”®ã€å”¯ä¸€é”®ã€å¤–é”®å»ºç«‹å…³è”
```

æœ€ç»ˆå½¢æˆä¸€ä¸ªç›¸äº’å…³è”çš„æ•°æ®ç½‘ç»œï¼Œæ”¯æŒå¤æ‚æ¸¸æˆé€»è¾‘çš„é…ç½®ã€‚

## ğŸ§± ç»“æ„ä½“ï¼ˆstructï¼‰

ç»“æ„ä½“ç”¨äºå®šä¹‰å¤åˆæ•°æ®ç±»å‹ï¼Œæ˜¯æ„å»ºå¤æ‚æ•°æ®ç»“æ„çš„åŸºç¡€ã€‚

### è¯­æ³•è§„åˆ™

- **å®šä¹‰æ ¼å¼**ï¼š`struct ç»“æ„ä½“åç§° { å­—æ®µå®šä¹‰ }`
- **å­—æ®µå®šä¹‰**ï¼š`å­—æ®µå:å­—æ®µç±»å‹; // æ³¨é‡Š`
- **å­—æ®µç±»å‹**ï¼š
  - **åŸºç¡€ç±»å‹**ï¼š`bool`, `int`, `float`, `long`, `str`, `text`
  - **èšåˆç±»å‹**ï¼š`struct`, `interface`
  - **å®¹å™¨ç±»å‹**ï¼š`list<ç±»å‹>`, `map<é”®ç±»å‹,å€¼ç±»å‹>`

### å¤–é”®å…³è”

- **å•å‘å¤–é”®ï¼ˆ->ï¼‰**ï¼šæŒ‡å‘è¡¨çš„ä¸»é”®æˆ–å”¯ä¸€é”®
  - æ ¼å¼ï¼š`å­—æ®µç±»å‹ ->è¡¨å`ï¼ˆæŒ‡å‘ä¸»é”®ï¼‰
  - æ ¼å¼ï¼š`å­—æ®µç±»å‹ ->è¡¨å[å”¯ä¸€é”®]`ï¼ˆæŒ‡å‘å”¯ä¸€é”®ï¼‰
- **å¤šå‘å¤–é”®ï¼ˆ=>ï¼‰**ï¼šæŒ‡å‘è¡¨çš„ä»»æ„å­—æ®µï¼Œç”Ÿæˆåå‘å¼•ç”¨åˆ—è¡¨
  - æ ¼å¼ï¼š`å­—æ®µç±»å‹ =>è¡¨å[å­—æ®µå]`
- **ç‹¬ç«‹å¤–é”®**ï¼š`->å¤–é”®å:[å­—æ®µåˆ—è¡¨] ->|=> ç›®æ ‡è¡¨`

> è¯¦ç»†å¤–é”®è¯´æ˜è¯·å‚è€ƒï¼š[ä¸»é”®ã€æšä¸¾ã€å¤–é”®](04.key.md)

### å®¹å™¨ç±»å‹å¤–é”®

- **listå¤–é”®**ï¼šåˆ—è¡¨ä¸­æ¯ä¸ªå…ƒç´ çš„å¤–é”®
- **mapå¤–é”®**ï¼šmapä¸­æ¯ä¸ªvalueçš„å¤–é”®ï¼ˆä¸æ”¯æŒkeyçš„å¤–é”®ï¼‰

#### å®¹å™¨å¤–é”®ç¤ºä¾‹

**listå¤–é”®**:
```cfg
struct RewardItem {
    // æ‰è½ç‰©å“åˆ—è¡¨ï¼Œæ¯ä¸ªç‰©å“IDéƒ½æŒ‡å‘itemè¡¨çš„itemå­—æ®µ
    itemids:list<int> ->item.item (fix=3);
}
```

**mapå¤–é”®**:
```cfg
struct MonsterDrops {
    // æ€ªç‰©æ‰è½è¡¨ï¼ŒvalueæŒ‡å‘itemè¡¨
    drops:map<int,int> =>item.item;
}
```

#### å®¹å™¨å¤–é”®éªŒè¯

ç³»ç»Ÿä¼šè‡ªåŠ¨éªŒè¯å®¹å™¨ä¸­çš„æ¯ä¸ªå¤–é”®å¼•ç”¨:
- **list<T>**: éªŒè¯åˆ—è¡¨ä¸­æ¯ä¸ªTç±»å‹çš„å¼•ç”¨
- **map<K,V>**: éªŒè¯æ¯ä¸ªvalueçš„å¼•ç”¨ï¼ˆkeyä¸æ”¯æŒå¤–é”®ï¼‰

### ç¤ºä¾‹

```cfg
// æ•°å€¼èŒƒå›´ç»“æ„
// ç”¨äºå®šä¹‰æœ€å°å€¼å’Œæœ€å¤§å€¼
struct Range {
	rmin:int; // æœ€å°å€¼
	rmax:int; // æœ€å¤§å€¼
}

// å¥–åŠ±ç‰©å“ç»“æ„
// åŒ…å«æ‰è½æ¦‚ç‡ã€ç‰©å“IDåˆ—è¡¨å’Œæ•°é‡èŒƒå›´
struct RewardItem {
	chance:int; // æ‰è½æ¦‚ç‡
	itemids:list<int> ->item.item (fix=2); // æ‰è½ç‰©å“åˆ—è¡¨ï¼Œæ¯ä¸ªç‰©å“æŒ‡å‘itemè¡¨
	range:Range; // æ•°é‡èŒƒå›´ï¼ˆåµŒå¥—ç»“æ„ï¼‰
}

// æ—¶é—´ç»“æ„
// ä½¿ç”¨å†’å·åˆ†éš”çš„å°æ—¶ã€åˆ†é’Ÿã€ç§’é…ç½®
struct Time (sep=':'){
    hour:int;   // å°æ—¶
    minute:int; // åˆ†é’Ÿ
    second:int; // ç§’
}
```

**ç‰¹æ€§è¯´æ˜ï¼š**
- `Range`ï¼šåŸºç¡€ç»“æ„ä½“ï¼Œå®šä¹‰æ•°å€¼èŒƒå›´
- `RewardItem`ï¼šå¤æ‚ç»“æ„ä½“ï¼ŒåŒ…å«åˆ—è¡¨å¤–é”®å’ŒåµŒå¥—ç»“æ„
- `Time`ï¼šä½¿ç”¨`(sep=':')`å±æ€§ï¼Œæ”¯æŒExcelä¸­ä»¥å†’å·åˆ†éš”çš„æ—¶é—´æ ¼å¼

## ğŸ¯ æ¥å£ï¼ˆinterfaceï¼‰

æ¥å£ç”¨äºå®šä¹‰å¤šæ€è¡Œä¸ºï¼Œæ”¯æŒå¤šç§å®ç°ç±»ï¼Œå¸¸ç”¨äºæ¸¸æˆé€»è¾‘çš„æ¡ä»¶åˆ¤æ–­å’Œå…¬å¼è®¡ç®—ã€‚

### æ ¸å¿ƒå±æ€§

- **enumRef**ï¼šæŒ‡å‘æšä¸¾è¡¨ï¼Œè¯¥è¡¨åŒ…å«æ¥å£æ‰€æœ‰å®ç°ç±»çš„ä¿¡æ¯
  - ä½œç”¨ï¼šè®©ç­–åˆ’åœ¨Excelä¸­é€šè¿‡ä¸‹æ‹‰èœå•é€‰æ‹©å®ç°ç±»ï¼Œæ— éœ€æŸ¥çœ‹CFGæ–‡ä»¶
  - è¦æ±‚ï¼šæšä¸¾è¡¨å¿…é¡»åŒ…å«å®ç°ç±»åç§°ï¼Œå¯åŒ…å«IDå’Œå…¶ä»–ä¿¡æ¯

- **defaultImpl**ï¼šæŒ‡å®šé»˜è®¤å®ç°ç±»
  - ä½œç”¨ï¼šExcelä¸­å¯ä¸æ˜¾å¼é…ç½®æ¥å£å­—æ®µï¼Œç³»ç»Ÿè‡ªåŠ¨ä½¿ç”¨é»˜è®¤å®ç°
  - ç‰¹æ®Šç”¨æ³•ï¼šé…åˆ`pack`å±æ€§ï¼Œå½“é»˜è®¤å®ç°åªåŒ…å«å•ä¸ªæ•°å­—å­—æ®µæ—¶ï¼ŒExcelä¸­å¯ç›´æ¥å¡«å†™æ•°å­—

- **pack**ï¼šæ‰“åŒ…å±æ€§ï¼Œç®€åŒ–Excelé…ç½®

### ç¤ºä¾‹

```cfg
// ä»»åŠ¡å®Œæˆæ¡ä»¶æ¥å£
// å®šä¹‰å¤šç§ä»»åŠ¡å®Œæˆæ¡ä»¶çš„å®ç°æ–¹å¼ï¼Œé€šè¿‡æšä¸¾è¡¨completeconditiontypeé€‰æ‹©
interface completecondition (enumRef='completeconditiontype') {
	// å‡»æ€æ€ªç‰©æ¡ä»¶
	struct KillMonster {
		monsterid:int ->npc.monster; // æ€ªç‰©IDï¼Œå¤–é”®æŒ‡å‘npcè¡¨
		count:int;                   // éœ€è¦å‡»æ€çš„æ•°é‡
	}

	// ä¸NPCå¯¹è¯æ¡ä»¶
	struct TalkNpc {
		npcid:int ->npc.npcid;       // NPC IDï¼Œå¤–é”®æŒ‡å‘npcè¡¨
	}

	// å¤šæ¡ä»¶ä¸é€»è¾‘
	struct ConditionAnd {
		cond1:task.completecondition (pack); // æ¡ä»¶1ï¼Œé€’å½’å¼•ç”¨
		cond2:task.completecondition (pack); // æ¡ä»¶2ï¼Œé€’å½’å¼•ç”¨
	}

	// æ”¶é›†ç‰©å“æ¡ä»¶
	struct CollectItem {
		itemid:int ->item.item;      // ç‰©å“IDï¼Œå¤–é”®æŒ‡å‘itemè¡¨
		count:int;                   // éœ€è¦æ”¶é›†çš„æ•°é‡
	}
}

// ä»»åŠ¡ç»éªŒå…¬å¼æ¥å£
// å®šä¹‰å¤šç§ç»éªŒè®¡ç®—æ–¹å¼ï¼Œé»˜è®¤ä½¿ç”¨å›ºå®šå€¼ï¼Œæ”¯æŒç›´æ¥å¡«å†™æ•°å­—
interface taskexp (enumRef='taskexptype', defaultImpl='ConstValue', pack) {
    // åŸºäºç©å®¶ç­‰çº§çš„ç»éªŒå…¬å¼
    struct ByLevel {
		levelcoef:float; // ç­‰çº§ç³»æ•°
		value:int;       // åŸºç¡€å€¼
	}

	// åŸºäºæœåŠ¡å™¨å¼€æœå¤©æ•°çš„ç»éªŒå…¬å¼
	struct ByServerUpDay {
		updaycoef1:float; // å¤©æ•°ç³»æ•°1
		updaycoef2:float; // å¤©æ•°ç³»æ•°2
		value:int;        // åŸºç¡€å€¼
	}

	// å›ºå®šç»éªŒå€¼
	struct ConstValue {
	    value:int;      // å›ºå®šç»éªŒå€¼
	}
}
```

**è®¾è®¡ä¼˜åŠ¿ï¼š**
- **å¯æ‰©å±•æ€§**ï¼šæ–°å¢ä»»åŠ¡å®Œæˆæ¡ä»¶åªéœ€æ·»åŠ æ–°çš„structå®ç°
- **æ˜“ç”¨æ€§**ï¼šç­–åˆ’é€šè¿‡ä¸‹æ‹‰èœå•é€‰æ‹©ï¼Œæ— éœ€äº†è§£æŠ€æœ¯ç»†èŠ‚
- **çµæ´»æ€§**ï¼šæ”¯æŒé€’å½’ç»„åˆï¼Œå¯æ„å»ºå¤æ‚æ¡ä»¶æ ‘
- **ç®€åŒ–é…ç½®**ï¼š`taskexp`æ¥å£æ”¯æŒç›´æ¥å¡«å†™æ•°å­—è¡¨ç¤ºå›ºå®šå€¼

## ğŸ“Š æ•°æ®è¡¨ï¼ˆtableï¼‰

æ•°æ®è¡¨æ˜¯å®é™…å­˜å‚¨é…ç½®æ•°æ®çš„å®¹å™¨ï¼Œæ”¯æŒç´¢å¼•ã€çº¦æŸå’Œå¤šæ€å­—æ®µã€‚

### è¡¨ç»“æ„å®šä¹‰

- **ä¸»é”®**ï¼šè¡¨ååçš„`[]`å†…å®šä¹‰ä¸»é”®å­—æ®µ
- **è¡¨å±æ€§**ï¼šä¸»é”®åçš„`()`å†…å®šä¹‰è¡¨çº§å±æ€§
- **å”¯ä¸€é”®**ï¼š`{}`å†…ä»¥`[å­—æ®µå]`å¼€å¤´çš„è¡Œå®šä¹‰å”¯ä¸€é”®
- **å­—æ®µå®šä¹‰**ï¼šä¸structè¯­æ³•ç›¸åŒ

> è¯¦ç»†ä¸»é”®ã€å”¯ä¸€é”®è¯´æ˜è¯·å‚è€ƒï¼š[ä¸»é”®ã€æšä¸¾ã€å¤–é”®](04.key.md)

### è¡¨çº§å±æ€§

- **enum**ï¼šæŒ‡å®šæšä¸¾å­—æ®µï¼Œè¯¥è¡¨ä½œä¸ºæšä¸¾è¡¨ä½¿ç”¨
  - ä½œç”¨ï¼šExcelä¸­è¯¥åˆ—ç”±ç¨‹åºå‘˜å¡«å†™ï¼Œæ¯è¡Œéƒ½å¿…é¡»æœ‰å€¼
  - ç”¨é€”ï¼šé…åˆinterfaceçš„enumRefå±æ€§

- **entry**ï¼šæŒ‡å®šå…¥å£å­—æ®µï¼Œç”Ÿæˆé™æ€è®¿é—®ä»£ç 
  - ä½œç”¨ï¼šExcelä¸­è¯¥åˆ—ç”±ç¨‹åºå‘˜å¡«å†™ï¼Œåªæœ‰ç‰¹å®šè¡Œéœ€è¦å€¼
  - ç”¨é€”ï¼šç¨‹åºä»£ç ä¸­é€šè¿‡é™æ€æˆå‘˜ç›´æ¥è®¿é—®ç‰¹å®šè¡Œ

### ç¤ºä¾‹

```cfg
// ä»»åŠ¡å®Œæˆæ¡ä»¶ç±»å‹æšä¸¾è¡¨
// ä¸ºcompleteconditionæ¥å£æä¾›ä¸‹æ‹‰é€‰é¡¹
table completeconditiontype[id] (enum='name') {
	id:int;   // ä»»åŠ¡å®Œæˆæ¡ä»¶ç±»å‹ID
	name:str; // ç¨‹åºç”¨åç§°ï¼ˆå¿…é¡»åŒ…å«completeconditionæ¥å£çš„æ‰€æœ‰å®ç°ç±»åï¼‰
}

// ä»»åŠ¡ç»éªŒå…¬å¼ç±»å‹æšä¸¾è¡¨
// ä¸ºtaskexpæ¥å£æä¾›ä¸‹æ‹‰é€‰é¡¹
table taskexptype[id] (enum='name') {
	id:int;   // ç»éªŒå…¬å¼ç±»å‹ID
	name:str; // ç¨‹åºç”¨åç§°ï¼ˆå¿…é¡»åŒ…å«taskexpæ¥å£çš„æ‰€æœ‰å®ç°ç±»åï¼‰
}

// ä»»åŠ¡é…ç½®è¡¨
// å­˜å‚¨æ‰€æœ‰ä»»åŠ¡æ•°æ®å’Œå®Œæˆæ¡ä»¶
table task[taskid] (entry='entry') {
	[nexttask];                           // å®šä¹‰å”¯ä¸€é”®
	taskid:int ->task.taskextraexp (nullable); // ä»»åŠ¡IDï¼Œå¤–é”®ï¼ˆå¯ç©ºï¼‰
	entry:str;                           // å…¥å£æ ‡è¯†ï¼Œç¨‹åºä»£ç ç›´æ¥è®¿é—®
	text:text;                           // å›½é™…åŒ–æ–‡æœ¬
	nexttask:int ->task (nullable);      // ä¸‹ä¸€ä¸ªä»»åŠ¡IDï¼Œå¤–é”®ï¼ˆå¯ç©ºï¼‰
	completecondition:task.completecondition; // ä»»åŠ¡å®Œæˆæ¡ä»¶ï¼ˆå¤šæ€æ¥å£ï¼‰
	exp:taskexp (mustFill);              // ç»éªŒå¥–åŠ±å…¬å¼ï¼ˆå¤šæ€æ¥å£ï¼Œå¿…é¡»å¡«å†™ï¼‰
	rewardItems:list<RewardItem> (block=1); // ç‰©å“å¥–åŠ±åˆ—è¡¨
	time:Time;                           // æ—¶é—´é…ç½®
}
```

**è¡¨è®¾è®¡è¯´æ˜ï¼š**
- **completeconditiontype**ï¼šæšä¸¾è¡¨ï¼Œå®šä¹‰ä»»åŠ¡å®Œæˆæ¡ä»¶ç±»å‹
- **taskexptype**ï¼šæšä¸¾è¡¨ï¼Œå®šä¹‰ç»éªŒå…¬å¼ç±»å‹
- **task**ï¼šä¸»ä»»åŠ¡è¡¨ï¼ŒåŒ…å«å¤æ‚çš„æ•°æ®ç»“æ„å’Œå…³è”å…³ç³»
- **å”¯ä¸€é”®**ï¼š`[nexttask]`ä¼šç”Ÿæˆ`GetByNextTask`è®¿é—®æ–¹æ³•
- **å¤šæ€å­—æ®µ**ï¼š`completecondition`å’Œ`exp`å­—æ®µæ”¯æŒå¤šç§å®ç°

## ğŸ› ï¸ å­—æ®µå±æ€§

å­—æ®µå¯ä»¥é…ç½®å¤šç§å±æ€§æ¥æ§åˆ¶æ•°æ®éªŒè¯å’Œç”Ÿæˆè¡Œä¸ºã€‚

### å¸¸ç”¨å±æ€§

| å±æ€§ | ç”¨é€” | é€‚ç”¨ç±»å‹ | ç¤ºä¾‹ |
|------|------|----------|------|
| `nullable` | å…è®¸å­—æ®µä¸ºç©º | æ‰€æœ‰ç±»å‹ | `field:int (nullable)` |
| `mustFill` | å¿…é¡»å¡«å†™ï¼Œä¸èƒ½ä¸ºç©º | æ‰€æœ‰ç±»å‹ | `field:str (mustFill)` |
| `fix=N` | å›ºå®šé•¿åº¦ï¼Œå ç”¨Nå€å…ƒç´ ç±»å‹çš„åˆ—æ•° | list, map | `items:list<int> (fix=3)` |
| `block=N` | å—çŠ¶æ˜ å°„ï¼Œæ¨ªå‘å›ºå®šNä¸ªå…ƒç´ ï¼Œçºµå‘å¯æ‰©å±• | list, map | `rewards:list<Reward> (block=1)` |
| `pack` | å‹ç¼©åˆ°1åˆ—ï¼Œç”¨é€—å·æˆ–åˆ†å·åˆ†éš” | struct, interface, list, map | `pos:Position (pack)` |
| `sep='åˆ†éš”ç¬¦'`| è‡ªå®šä¹‰åˆ†éš”ç¬¦ï¼Œå‹ç¼©åˆ°1åˆ— | struct, list | `time:Time (sep=':')` |

> è¯¦ç»†æ˜ å°„è§„åˆ™è¯·å‚è€ƒï¼š[æ˜ å°„åˆ°è¡¨æ ¼](05.tabularMapping.md)

### å±æ€§è¯¦è§£

#### fix (å›ºå®šé•¿åº¦æ˜ å°„)

å°†åˆ—è¡¨æˆ–æ˜ å°„å›ºå®šä¸ºæŒ‡å®šé•¿åº¦ï¼Œåœ¨Excelä¸­å ç”¨å›ºå®šåˆ—æ•°ã€‚

**ä½¿ç”¨åœºæ™¯**:
- å·²çŸ¥ç¡®åˆ‡é•¿åº¦çš„åˆ—è¡¨ï¼Œå¦‚è£…å¤‡çš„3ä¸ªå®çŸ³æ§½
- å›ºå®šæ•°é‡çš„å±æ€§åŠ æˆ

**ç¤ºä¾‹**:
```cfg
struct Equipment {
    // å›ºå®š3ä¸ªå®çŸ³æ§½
    gemSlots:list<int> ->item.gem (fix=3);

    // å›ºå®š2ä¸ªå±æ€§åŠ æˆ
    attrPairs:list<AttrPair> (fix=2);
}
```

**Excelå¸ƒå±€**:
```
| gemSlots1 | gemSlots2 | gemSlots3 | attrPairs1 | attrPairs1 | attrPairs2 | attrPairs2 |
|-----------|-----------|-----------|------------|------------|------------|------------|
| 1001      | 1002      | 1003      | 1          | 100        | 2          | 50         |
```

#### block (å—çŠ¶æ˜ å°„)

å°†åˆ—è¡¨æ¨ªå‘å›ºå®šNä¸ªå…ƒç´ ï¼Œçºµå‘å¯æ— é™æ‰©å±•ã€‚é€‚åˆå˜é•¿åˆ—è¡¨ã€‚

**ä½¿ç”¨åœºæ™¯**:
- æ•°é‡ä¸å®šçš„å¥–åŠ±åˆ—è¡¨
- å¯å˜é•¿åº¦çš„ä»»åŠ¡æ¡ä»¶

**ç¤ºä¾‹**:
```cfg
struct Task {
    // å¥–åŠ±åˆ—è¡¨ï¼Œæ¨ªå‘1ä¸ªå…ƒç´ ï¼Œçºµå‘å¯æ‰©å±•
    rewards:list<Reward> (block=1);
}
```

**Excelå¸ƒå±€**:
```
| rewards | rewards |
|---------|---------|
| 1001    | 5       |  <- ç¬¬1ä¸ªå¥–åŠ±
| 1002    | 10      |  <- ç¬¬2ä¸ªå¥–åŠ±
| 1003    | 3       |  <- ç¬¬3ä¸ªå¥–åŠ±
```

**é‡è¦**: Blockæ˜ å°„é€šè¿‡ç©ºå•å…ƒæ ¼åˆ¤æ–­è¾¹ç•Œï¼Œæ¨èé…åˆ`mustFill`ä½¿ç”¨å…³é”®å­—æ®µã€‚

#### pack (å‹ç¼©æ˜ å°„)

å°†å¤æ‚æ•°æ®ç»“æ„å‹ç¼©åˆ°1åˆ—ï¼Œä½¿ç”¨é€—å·æˆ–åˆ†å·åˆ†éš”ã€‚

**ä½¿ç”¨åœºæ™¯**:
- å‡å°‘Excelåˆ—æ•°
- å¤„ç†é€’å½’ç»“æ„ï¼ˆå¿…é¡»ä½¿ç”¨packæ‰“ç ´å¾ªç¯ï¼‰
- ç®€åŒ–é…ç½®

**ç¤ºä¾‹**:
```cfg
// ä¸‰ç»´åæ ‡
struct Position (pack) {
    x:int;
    y:int;
    z:int;
}

// ä½¿ç”¨
struct Player {
    pos:Position;  // Excelä¸­å¡«å†™: "100,200,300"
}

// åˆ—è¡¨ä¹Ÿæ”¯æŒ
positions:list<Position> (pack);  // Excelä¸­å¡«å†™: "(100,200,300);(150,250,350)"
```

#### sep (åˆ†éš”ç¬¦æ˜ å°„)

ç±»ä¼¼packï¼Œä½†ä½¿ç”¨è‡ªå®šä¹‰åˆ†éš”ç¬¦ã€‚

**ç¤ºä¾‹**:
```cfg
// æ—¶é—´æ ¼å¼ HH:MM:SS
struct Time (sep=':') {
    hour:int;
    minute:int;
    second:int;
}

// Excelä¸­å¡«å†™: "12:30:45"
```

#### mustFill (å¿…å¡«çº¦æŸ)

å¼ºåˆ¶å­—æ®µå¿…é¡»æœ‰å€¼ï¼Œé˜²æ­¢ç©ºå€¼å¯¼è‡´çš„æ•°æ®åˆå¹¶é”™è¯¯ã€‚

**ç¤ºä¾‹**:
```cfg
struct Task {
    // å¿…é¡»é…ç½®ç»éªŒå¥–åŠ±
    exp:TaskExp (mustFill);

    // å¥–åŠ±åˆ—è¡¨å¯é€‰
    rewards:list<Reward> (block=1);
}
```

### å±æ€§ç»„åˆç¤ºä¾‹

```cfg
// å¤æ‚å±æ€§ç»„åˆç¤ºä¾‹
struct RewardItem {
    chance:int;                          // æ‰è½æ¦‚ç‡
    itemids:list<int> ->item.item (fix=2); // å›ºå®š2ä¸ªç‰©å“ID
    range:Range (pack);                   // æ•°é‡èŒƒå›´ï¼ˆå‹ç¼©ï¼‰
}
```

### å±æ€§ç¤ºä¾‹

```cfg
// å­—æ®µå±æ€§ç¤ºä¾‹
// æ¼”ç¤ºnullableã€mustFillã€fixã€blockç­‰å¸¸ç”¨å±æ€§
struct Example {
	optionalField:int (nullable);     // å¯ç©ºå­—æ®µ
	requiredField:str (mustFill);     // å¿…é¡»å¡«å†™
	fixedList:list<int> (fix=3);      // å›ºå®š3ä¸ªå…ƒç´ çš„åˆ—è¡¨
	blockList:list<Item> (block=2);   // å—å¤§å°ä¸º2çš„åˆ—è¡¨
}
```

## ğŸ“‹ å®Œæ•´ç¤ºä¾‹ï¼šä»»åŠ¡ç³»ç»Ÿ

ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®Œæ•´çš„ä»»åŠ¡ç³»ç»Ÿé…ç½®ï¼Œå±•ç¤ºäº†å„ç»„ä»¶å¦‚ä½•ååŒå·¥ä½œï¼š

```cfg
// ========== åŸºç¡€æ•°æ®ç»“æ„ ==========
// æ•°å€¼èŒƒå›´ç»“æ„
struct Range {
	rmin:int; // æœ€å°å€¼
	rmax:int; // æœ€å¤§å€¼
}

// å¥–åŠ±ç‰©å“ç»“æ„
struct RewardItem {
	chance:int; // æ‰è½æ¦‚ç‡
	itemids:list<int> ->item.item (fix=2); // æ‰è½ç‰©å“
	range:Range; // æ•°é‡èŒƒå›´
}

// æ—¶é—´ç»“æ„ï¼ˆå†’å·åˆ†éš”ï¼‰
struct Time (sep=':'){
    hour:int;   // å°æ—¶
    minute:int; // åˆ†é’Ÿ
    second:int; // ç§’
}

// ========== å¤šæ€æ¥å£å®šä¹‰ ==========
// ä»»åŠ¡å®Œæˆæ¡ä»¶æ¥å£
interface completecondition (enumRef='completeconditiontype') {
	// å‡»æ€æ€ªç‰©æ¡ä»¶
	struct KillMonster {
		monsterid:int ->npc.monster; // æ€ªç‰©ID
		count:int;                   // å‡»æ€æ•°é‡
	}

	// ä¸NPCå¯¹è¯æ¡ä»¶
	struct TalkNpc {
		npcid:int ->npc.npcid;       // NPC ID
	}

	// å¤šæ¡ä»¶ä¸é€»è¾‘
	struct ConditionAnd {
		cond1:task.completecondition (pack); // æ¡ä»¶1
		cond2:task.completecondition (pack); // æ¡ä»¶2
	}

	// æ”¶é›†ç‰©å“æ¡ä»¶
	struct CollectItem {
		itemid:int ->item.item;      // ç‰©å“ID
		count:int;                   // æ”¶é›†æ•°é‡
	}
}

// ä»»åŠ¡ç»éªŒå…¬å¼æ¥å£
interface taskexp (enumRef='taskexptype', defaultImpl='ConstValue', pack) {
    // åŸºäºç©å®¶ç­‰çº§çš„ç»éªŒå…¬å¼
    struct ByLevel {
		levelcoef:float; // ç­‰çº§ç³»æ•°
		value:int;       // åŸºç¡€å€¼
	}

	// åŸºäºæœåŠ¡å™¨å¼€æœå¤©æ•°çš„ç»éªŒå…¬å¼
	struct ByServerUpDay {
		updaycoef1:float; // å¤©æ•°ç³»æ•°1
		updaycoef2:float; // å¤©æ•°ç³»æ•°2
		value:int;        // åŸºç¡€å€¼
	}

	// å›ºå®šç»éªŒå€¼
	struct ConstValue {
	    value:int;      // å›ºå®šç»éªŒ
	}
}

// ========== æšä¸¾è¡¨ ==========
// ä»»åŠ¡å®Œæˆæ¡ä»¶ç±»å‹æšä¸¾è¡¨
table completeconditiontype[id] (enum='name') {
	id:int;   // ç±»å‹ID
	name:str; // å®ç°ç±»åç§°
}

// ä»»åŠ¡ç»éªŒå…¬å¼ç±»å‹æšä¸¾è¡¨
table taskexptype[id] (enum='name') {
	id:int;   // å…¬å¼ç±»å‹ID
	name:str; // å®ç°ç±»åç§°
}

// ========== ä¸»ä»»åŠ¡è¡¨ ==========
// ä»»åŠ¡é…ç½®è¡¨
table task[taskid] (entry='entry') {
	[nexttask];                           // å”¯ä¸€é”®ï¼šä¸‹ä¸€ä¸ªä»»åŠ¡
	taskid:int ->task.taskextraexp (nullable); // ä»»åŠ¡ID
	entry:str;                           // å…¥å£æ ‡è¯†
	text:text;                           // ä»»åŠ¡æ–‡æœ¬
	nexttask:int ->task (nullable);      // ä¸‹ä¸€ä¸ªä»»åŠ¡
	completecondition:task.completecondition; // å®Œæˆæ¡ä»¶
	exp:taskexp (mustFill);              // ç»éªŒå¥–åŠ±
	rewardItems:list<RewardItem> (block=1); // ç‰©å“å¥–åŠ±
	time:Time;                           // æ—¶é—´é…ç½®
}
```

## ğŸ“– å¿«é€Ÿå‚è€ƒ

### è¯­æ³•é€ŸæŸ¥

| æ„é€  | è¯­æ³• | ç”¨é€” |
|------|------|------|
| ç»“æ„ä½“ | `struct åç§° { å­—æ®µ:ç±»å‹; }` | å®šä¹‰å¤åˆæ•°æ®ç±»å‹ |
| æ¥å£ | `interface åç§° { struct å®ç°ç±» { ... } }` | å®šä¹‰å¤šæ€è¡Œä¸º |
| æ•°æ®è¡¨ | `table è¡¨å[ä¸»é”®] { [å”¯ä¸€é”®]; å­—æ®µ:ç±»å‹; }` | å­˜å‚¨é…ç½®æ•°æ® |
| å¤–é”® | `å­—æ®µ:ç±»å‹ ->ç›®æ ‡è¡¨` | å»ºç«‹è¡¨é—´å…³è” |
| å¤šå‘å¤–é”® | `å­—æ®µ:ç±»å‹ =>ç›®æ ‡è¡¨[å­—æ®µ]` | å»ºç«‹åå‘å¼•ç”¨ |

### å±æ€§é€ŸæŸ¥

| å±æ€§ | ä½ç½® | ç”¨é€” |
|------|------|------|
| `enumRef='è¡¨å'` | interface | æŒ‡å®šæšä¸¾è¡¨ |
| `defaultImpl='ç±»å'` | interface | æŒ‡å®šé»˜è®¤å®ç° |
| `enum='å­—æ®µå'` | table | æŒ‡å®šæšä¸¾å­—æ®µ |
| `entry='å­—æ®µå'` | table | æŒ‡å®šå…¥å£å­—æ®µ |
| `nullable` | å­—æ®µ | å…è®¸ä¸ºç©º |
| `mustFill` | å­—æ®µ | å¿…é¡»å¡«å†™ |
| `fix=N` | æ˜ å°„... | ... |
| `block=N` | æ˜ å°„... | ... |
| `pack` | æ˜ å°„... | ... |
| `sep='åˆ†éš”ç¬¦'` | æ˜ å°„... | ... |

### ç±»å‹ç³»ç»Ÿ

| ç±»å‹åˆ†ç±» | å…·ä½“ç±»å‹ | æè¿° |
|----------|----------|------|
| åŸºç¡€ç±»å‹ | `bool`, `int`, `float`, `long`, `str`, `text` | åŸºæœ¬æ•°æ®ç±»å‹ |
| å®¹å™¨ç±»å‹ | `list<T>`, `map<K,V>` | é›†åˆæ•°æ®ç±»å‹ |
| èšåˆç±»å‹ | `struct`, `interface` | å¤åˆæ•°æ®ç±»å‹ |
| å¼•ç”¨ | `->è¡¨å`,`->è¡¨å[å”¯ä¸€é”®]`, `=>è¡¨å[å­—æ®µ]` | è¡¨é—´å…³è” |

## ğŸ“ CFG æ–‡ä»¶ä¸æ•°æ®æ–‡ä»¶çš„å¯¹åº”å…³ç³»

### æ–‡ä»¶ç»„ç»‡æ–¹å¼

cfggen æ”¯æŒä¸¤ç§æ•°æ®æ–‡ä»¶ç»„ç»‡æ–¹å¼ï¼š

#### æ–¹å¼ 1: å¹³é“ºç»“æ„ï¼ˆé€‚åˆå°å‹é¡¹ç›®ï¼‰

```
config/
â”œâ”€â”€ config.cfg           # ç»“æ„å®šä¹‰æ–‡ä»¶
â”œâ”€â”€ item.xlsx            # itemè¡¨æ•°æ®ï¼ˆå·¥ä½œè¡¨åä¸ºitemï¼‰
â”œâ”€â”€ task.xlsx            # taskè¡¨æ•°æ®ï¼ˆå·¥ä½œè¡¨åä¸ºtaskï¼‰
â””â”€â”€ reward.xlsx          # rewardè¡¨æ•°æ®
```

**ç‰¹ç‚¹**:
- æ‰€æœ‰ Excel æ–‡ä»¶ç›´æ¥æ”¾åœ¨ `config/` ç›®å½•
- ä¸€ä¸ª Excel æ–‡ä»¶åŒ…å«ä¸€ä¸ªè¡¨çš„æ•°æ®
- æ–‡ä»¶å = è¡¨å

#### æ–¹å¼ 2: æ¨¡å—åŒ–ç›®å½•ç»“æ„ï¼ˆæ¨èï¼Œé€‚åˆä¸­å¤§å‹é¡¹ç›®ï¼‰

```
config/
â”œâ”€â”€ config.cfg                           # ç»“æ„å®šä¹‰æ–‡ä»¶
â”‚
â”œâ”€â”€ item/                                # itemæ¨¡å—ç›®å½•
â”‚   â”œâ”€â”€ item.xlsx                        # itemè¡¨æ•°æ®
â”‚   â””â”€â”€ itemtype.xlsx                   # itemtypeè¡¨æ•°æ®
â”‚
â”œâ”€â”€ task/                                # taskæ¨¡å—ç›®å½•
â”‚   â”œâ”€â”€ task_ä»»åŠ¡.xlsx                   # taskè¡¨ï¼ˆä¸­æ–‡åˆ«åï¼‰
â”‚   â”œâ”€â”€ completeconditiontype.xlsx       # ä»»åŠ¡å®Œæˆæ¡ä»¶ç±»å‹
â”‚   â””â”€â”€ taskextraexp.xlsx               # ä»»åŠ¡é¢å¤–ç»éªŒ
â”‚
â””â”€â”€ equip/                               # equipæ¨¡å—ç›®å½•
    â”œâ”€â”€ equip.xlsx                       # equipè¡¨
    â””â”€â”€ rank.xlsx                        # rankè¡¨
```

**ç‰¹ç‚¹**:
- æŒ‰åŠŸèƒ½æ¨¡å—ç»„ç»‡ç›®å½•
- æ”¯æŒä¸­æ–‡åˆ«åï¼ˆå¦‚ `task_ä»»åŠ¡.xlsx`ï¼‰
- ä¸€ä¸ªæ¨¡å—åŒ…å«ç›¸å…³çš„å¤šä¸ªè¡¨

### Excel æ–‡ä»¶ç»“æ„

#### å•è¡¨å•æ–‡ä»¶

**æ–‡ä»¶**: `config/item/item.xlsx`

| å·¥ä½œè¡¨å | å†…å®¹ |
|----------|------|
| `item`   | itemè¡¨çš„æ•°æ® |

**è¡¨åæ˜ å°„è§„åˆ™**:
- æ–‡ä»¶å: `item.xlsx` â†’ è¡¨å: `item`
- æ–‡ä»¶å: `task_ä»»åŠ¡.xlsx` â†’ è¡¨å: `task`ï¼ˆå¿½ç•¥åç¼€åˆ«åï¼‰

#### å•è¡¨å¤šæ–‡ä»¶ï¼ˆJSON æ ¼å¼ï¼‰

```
config/task/
â”œâ”€â”€ 1.json       # taskè¡¨çš„ä¸»é”®=1çš„è®°å½•
â”œâ”€â”€ 2.json       # taskè¡¨çš„ä¸»é”®=2çš„è®°å½•
â””â”€â”€ 3.json       # taskè¡¨çš„ä¸»é”®=3çš„è®°å½•
```

**ç‰¹ç‚¹**:
- æ¯ä¸ªæ–‡ä»¶å¯¹åº”è¡¨ä¸­çš„ä¸€æ¡è®°å½•
- æ–‡ä»¶å = ä¸»é”®å€¼
- é€‚åˆç¨‹åºè‡ªåŠ¨ç”Ÿæˆæˆ–ç‰ˆæœ¬æ§åˆ¶

### Excel å·¥ä½œè¡¨ä¸å­—æ®µçš„æ˜ å°„

#### ç®€å•ç»“æ„æ˜ å°„

**CFG å®šä¹‰**:
```cfg
table item[id] {
    id:int;
    name:str;
    type:int;
    price:int;
}
```

**Excel è¡¨æ ¼**:

| id | name | type | price |
|----|------|------|-------|
| 1001 | é“å‰‘ | 1 | 100 |
| 1002 | é’¢ç›¾ | 2 | 150 |

#### å¤æ‚ç»“æ„æ˜ å°„ï¼ˆåµŒå¥—ï¼‰

**CFG å®šä¹‰**:
```cfg
struct Reward {
    itemId:int ->item.item;
    count:int;
}

table task[id] {
    id:int;
    name:str;
    rewards:list<Reward> (block=1);
}
```

**Excel è¡¨æ ¼**:

| id | name | rewards | rewards |
|----|------|---------|---------|
| 1 | å‡»æ€æ€ªç‰© | 1001    | 5       | â† ç¬¬1ä¸ªreward |
|   |       | 1002    | 10      | â† ç¬¬2ä¸ªreward |
| 2 | æ”¶é›†ç‰©å“ | 2001    | 3       | â† ç¬¬1ä¸ªreward |

**æ˜ å°„è¯´æ˜**:
- `list<Reward> (block=1)` æ¨ªå‘å ç”¨2åˆ—ï¼ˆRewardçš„2ä¸ªå­—æ®µï¼‰
- çºµå‘å¯æ‰©å±•ï¼ˆç©ºå•å…ƒæ ¼è¡¨ç¤ºåŒä¸€æ¡è®°å½•ï¼‰
- ç¬¬2è¡Œçš„ç©ºå•å…ƒæ ¼è¡¨ç¤ºä»å±äº task id=1 çš„è®°å½•

#### å¤æ‚ç»“æ„æ˜ å°„ï¼ˆå‹ç¼©ï¼‰

**CFG å®šä¹‰**:
```cfg
struct Position (pack) {
    x:int;
    y:int;
    z:int;
}

table monster[id] {
    id:int;
    name:str;
    pos:Position;
}
```

**Excel è¡¨æ ¼**:

| id | name | pos |
|----|------|-----|
| 1 | å²è±å§† | 100,200,0 |
| 2 | é¾™ | 500,600,100 |

**æ˜ å°„è¯´æ˜**:
- `(pack)` å°† Position ç»“æ„å‹ç¼©åˆ°1åˆ—
- ä½¿ç”¨é€—å·åˆ†éš”å­—æ®µå€¼

### æ–‡ä»¶è·¯å¾„è§„åˆ™æ€»ç»“

| æ–‡ä»¶ä½ç½® | è¡¨å | è¯´æ˜ |
|----------|------|------|
| `config/item.xlsx` | `item` | ç›´æ¥å¯¹åº” |
| `config/item/item.xlsx` | `item` | æ¨¡å—ç›®å½•ä¸‹ |
| `config/task/task_ä»»åŠ¡.xlsx` | `task` | å¿½ç•¥ä¸­æ–‡åˆ«å |
| `config/task/1.json` | `task` (id=1) | JSONå•æ–‡ä»¶è®°å½• |

### æœ€ä½³å®è·µ

1. **å°å‹é¡¹ç›®**: ä½¿ç”¨å¹³é“ºç»“æ„ï¼Œç®€å•ç›´æ¥
2. **ä¸­å¤§å‹é¡¹ç›®**: ä½¿ç”¨æ¨¡å—åŒ–ç›®å½•ç»“æ„ï¼Œä¾¿äºç®¡ç†
3. **å¤šè¯­è¨€æ”¯æŒ**: ä½¿ç”¨ä¸­æ–‡åˆ«åï¼ˆå¦‚ `task_ä»»åŠ¡.xlsx`ï¼‰æé«˜å¯è¯»æ€§
4. **ç¨‹åºç”Ÿæˆ**: ä½¿ç”¨ JSON æ ¼å¼ï¼Œä¾¿äºè‡ªåŠ¨åŒ–å’Œç‰ˆæœ¬æ§åˆ¶
5. **ç‰ˆæœ¬æ§åˆ¶**: å°† `.xlsx` è½¬æ¢ä¸º `.csv` æˆ– `.json` åçº³å…¥ Git

