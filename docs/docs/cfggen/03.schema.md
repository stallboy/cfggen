---
layout: page
title: ç»“æ„å®šä¹‰
parent: é…è¡¨ç³»ç»Ÿ
nav_order: 3
---

# ğŸ—ï¸ ç»“æ„å®šä¹‰
{: .no_toc }

## Table of contents
{: .no_toc .text-delta }

- TOC
{:toc}
---

```
æˆ‘ä»¬çš„ç›®çš„æ˜¯è¦è¡¨è¾¾ç»“æ„åŒ–çš„ä¿¡æ¯ã€‚

int,float,str,bool,long,textåŸºç¡€ç±»å‹æ˜¯æ„å»ºçš„åŸºæœ¬å—
structæ¥èšåˆæˆæ–°ç»“æ„ï¼Œstructå¯ä»¥åµŒå¥—
list,mapè¡¨è¾¾åˆ—è¡¨
interfaceæ¥è¡¨è¾¾å¤šæ€ï¼Œæ¯”å¦‚ä»»åŠ¡å®Œæˆæ¡ä»¶ï¼Œæœ‰å¤šé‡ç±»å‹
tableåˆ™æ—¢è¡¨è¾¾äº†structï¼Œä¹Ÿæ˜¯å…·ä½“çš„æ•°æ®æ‰€åœ¨ã€‚
    é€šè¿‡ä¸»é”®ã€å”¯ä¸€é”®ã€enumã€entryæ¥ç´¢å¼•åˆ°å…·ä½“ä¸€è¡Œ

åˆé€šè¿‡fieldä¸Šè®¾ç½®å¤–é”®ï¼Œæ¥è¿æˆæ•°æ®çš„ç½‘ç»œã€‚
```

---

## ğŸ§± structï¼šå®šä¹‰ç»“æ„

- structåæ¥ç»“æ„ä½“åç§°ï¼Œç„¶ååœ¨{}é‡Œæ¯è¡Œå®šä¹‰fieldæˆ–å¤–é”®
- fieldï¼šå­—æ®µååå­—åé¢åŠ :ï¼Œç„¶åæ˜¯**å­—æ®µç±»å‹**
- å­—æ®µç±»å‹ï¼š
  - åŸºæœ¬ç±»å‹primitiveï¼šboolï¼Œintï¼Œfloatï¼Œlongï¼Œstrï¼Œtext
  - èšåˆï¼šstructï¼Œinterface
  - å®¹å™¨ï¼šlistï¼Œmap
- å­—æ®µç±»å‹åå¯ä»¥æ¥->ï¼Œè¡¨æ˜æ˜¯**å¤–é”®**ï¼Œåæ¥tableåç§°ï¼Œå¦‚æœä¸æ˜¯æŒ‡å‘tableçš„ä¸»é”®ï¼Œåˆ™è¦æ¥[]ï¼Œ[]å†…å«tableçš„å”¯ä¸€é”®
- å­—æ®µç±»å‹åå¯ä»¥æ¥=>ï¼Œåæ¥tableåç§°[]ï¼Œ[]å†…å«tableçš„fieldåç§° è¿™é‡Œæ‰©å±•äº†æ•°æ®åº“çš„å¤–é”®å«ä¹‰ï¼Œ
  ç”¨=>è¡¨æ˜ä¸ä¸€å®šæŒ‡å‘tableçš„å”¯ä¸€é”®ï¼Œè€Œæ˜¯ä»»æ„å­—æ®µï¼Œç”Ÿæˆçš„ç¨‹åºä»£ç ä¼šè¿”å›listRefXxxï¼Œæ˜¯ä¸ªåˆ—è¡¨ã€‚
- {}å†…è¡Œå¦‚æœä»¥->å¼€å¤´ï¼Œè¡¨æ˜æ˜¯å¤–é”®ï¼Œ->åæ¥ä¸€ä¸ªidentifierï¼Œç„¶å:ï¼Œç„¶å[],[]å†…æ˜¯å­—æ®µååˆ—è¡¨ï¼Œç„¶åæ˜¯->æˆ–=>,ä¹‹åè·Ÿå­—æ®µç±»å‹åæ¥çš„ä¸€è‡´ã€‚
- listç±»å‹é…ç½®å¤–é”®æ—¶ï¼Œè¡¨æ˜listé‡Œæ¯ä¸ªitemçš„å¤–é”®
- mapç±»å‹é…ç½®å¤–é”®æ—¶ï¼Œè¡¨æ˜æ—¶mapé‡Œæ¯ä¸ªvalueçš„å¤–é”®ï¼Œï¼ˆä¸æ”¯æŒkeyçš„å¤–é”®é…ç½®ï¼‰

### ä¾‹å­

```
struct Range {
	rmin:int; // æœ€å°
	rmax:int; // æœ€å¤§
}

struct RewardItem {
	chance:int; // æ‰è½æ¦‚ç‡
	itemids:list<int> ->item.item (fix=2); // æ‰è½ç‰©å“
	range:Range; // æ•°é‡èŒƒå›´
}

struct Time (sep=':'){
    hour:int;
    minute:int;
    second:int;
}
```

**è¯´æ˜ï¼š**
- `Range`ç»“æ„ä½“åŒ…å«ä¸¤ä¸ªæ•´æ•°å­—æ®µï¼Œè¡¨ç¤ºèŒƒå›´çš„æœ€å°å€¼å’Œæœ€å¤§å€¼
- `RewardItem`ç»“æ„ä½“ä¸­ï¼Œ`range`å­—æ®µçš„ç±»å‹æ˜¯`Range`ï¼Œè¿™æ˜¯å¯¹åµŒå¥—ç»“æ„çš„æ”¯æŒ
- `RewardItem.itemids`å­—æ®µé…ç½®äº†`->item.item`ï¼Œè¡¨æ˜è¿™ä¸ª`list<int>`é‡Œæ¯ä¸ªintéƒ½æŒ‡å‘item.itemè¡¨
- `Time`ç»“æ„ä½“ä½¿ç”¨äº†`(sep=':')`å±æ€§ï¼Œè¡¨ç¤ºåœ¨Excelä¸­å¯ä»¥ç”¨å†’å·åˆ†éš”çš„æ—¶é—´æ ¼å¼


## ğŸ¯ interfaceï¼šå®šä¹‰æ¥å£

- interfaceå†…å®šä¹‰structåšä¸ºæ­¤æ¥å£çš„å®ç°ç±»
- interfaceåé¢()å†…å¯ä»¥åŠ **enumRef**å±æ€§ï¼ŒæŒ‡å‘ä¸€ä¸ªè¡¨åï¼Œè¿™ä¸ªè¡¨é‡Œä¼šæœ‰å…¶å®ç°ç±»çš„ä¿¡æ¯ï¼Œ
  å‡å¦‚è¿™ä¸ªè¡¨ç­–åˆ’ç”¨excelæ¥é…ï¼Œåˆ™æœ‰enumRefåç­–åˆ’å¯ä»¥ä¸ç”¨çœ‹.cfgæ–‡ä»¶ã€‚è¿™ä¸ªè¡¨å¿…é¡»åŒ…å«å…¶å®ç°ç±»çš„åç§°ï¼Œä¹Ÿå¯ä»¥ç»™idï¼Œå¯ä»¥åŒ…å«ä»»æ„é¢å¤–ä¿¡æ¯ã€‚
- ()å†…å¯ä»¥åŠ **defaultImpl**å±æ€§ï¼ŒæŒ‡å‘ä¸€ä¸ªæ­¤æ¥å£å®ç°ç±»ï¼Œå¦‚æœæœ‰è¿™ä¸ªå±æ€§ï¼Œåˆ™excelä¸­å¯ä»¥ä¸é…ç½®è¿™ä¸ªå±æ€§ï¼Œæ­¤æ—¶ç¨‹åºä¼šè¯»æˆè¿™ä¸ªé»˜è®¤å®ç°ã€‚
- å¦‚æœdefaultImplæŒ‡å‘çš„ç»“æ„ï¼ŒåªåŒ…å«ä¸€ä¸ªæ•°å­—æˆ–boolï¼Œå¹¶ä¸”æ­¤interfaceæ˜¯packï¼Œåˆ™excelä¸­å¯ä»¥ç›´æ¥å†™ä¸€ä¸ªæ•°å­—ï¼Œæ­¤æ—¶ç¨‹åºä¼šè¯»æˆè¿™ä¸ªé»˜è®¤å®ç°ï¼Œé‡Œé¢å­—æ®µä¸ºæ­¤æ•°å­—ã€‚

### ä¾‹å­

```
interface completecondition (enumRef='completeconditiontype') {
	struct KillMonster {
		monsterid:int ->npc.monster;
		count:int;
	}

	struct TalkNpc {
		npcid:int ->npc.npcid;
	}

	struct ConditionAnd {
		cond1:task.completecondition (pack);
		cond2:task.completecondition (pack);
	}

	struct CollectItem {
		itemid:int ->item.item;
		count:int;
	}
}

interface taskexp (enumRef='taskexptype', defaultImpl='ConstValue', pack) {
    struct ByLevel { // ç©å®¶ç­‰çº§ç›¸å…³
		levelcoef:float;
		value:int;
	}

	struct ByServerUpDay { // æœåŠ¡å™¨å¯åŠ¨å¤©æ•°ç›¸å…³
		updaycoef1:float;
		updaycoef2:float;
		value:int;
	}

	struct ConstValue { // å›ºå®šå€¼
	    value:int;
	}
}
```

**è¯´æ˜ï¼š**
- `completecondition`æ¥å£å®šä¹‰äº†ä»»åŠ¡å®Œæˆæ¡ä»¶çš„å¤šç§å®ç°ï¼Œä½¿ç”¨äº†`enumRef='completeconditiontype'`å±æ€§
- `KillMonster.monsterid`å­—æ®µé…ç½®äº†`->npc.monster`ï¼Œè¡¨æ˜è¿™ä¸ªidæ˜¯ä¸ªå¤–é”®ï¼ŒæŒ‡å‘npc.monsterè¡¨
- `ConditionAnd`ç»“æ„ä¸­çš„å­—æ®µç±»å‹åˆæ˜¯`completecondition`ï¼Œå½¢æˆäº†é€’å½’ç»“æ„ï¼Œå¯ä»¥æ„å»ºä»»æ„å¤æ‚çš„æ¡ä»¶ç»„åˆ
- `taskexp`æ¥å£å®šä¹‰äº†ä»»åŠ¡ç»éªŒå€¼å…¬å¼ï¼Œä½¿ç”¨äº†`defaultImpl='ConstValue'`å±æ€§ï¼ŒExcelä¸­å¤§å¤šæ•°æƒ…å†µä¸‹å¯ä»¥ç›´æ¥å†™æ•°å­—
- `taskexp`æ¥å£è¿˜ä½¿ç”¨äº†`pack`å±æ€§ï¼Œé…åˆ`defaultImpl`ï¼Œå¯ä»¥åœ¨Excelä¸­ç›´æ¥å†™æ•°å­—è¡¨ç¤ºConstValueå®ç°

## ğŸ“Š tableï¼šå®šä¹‰è¡¨ç»“æ„

- è¡¨åå[]å†…æ˜¯æ­¤è¡¨çš„**ä¸»é”®**
- è¡¨å[ä¸»é”®]åçš„()å†…å¯ä»¥åŒ…å«**enum**ï¼ŒæŒ‡å‘fieldåç§°ï¼Œè¡¨æ˜æ­¤è¡¨æ˜¯ä¸ªæšä¸¾è¡¨ï¼Œexcelä¸­è¿™ä¸€åˆ—ç”±ç¨‹åºå‘˜æ¥å¡«å†™ï¼Œæ¯è¡Œéƒ½è¦å¡«
- è¡¨å[ä¸»é”®]åçš„()å†…å¯ä»¥åŒ…å«**entry**ï¼ŒæŒ‡å‘fieldåç§°ï¼Œè¿™ä¸ªä¼šä¸ºç¨‹åºç”Ÿæˆé™æ€æˆå‘˜å˜é‡ï¼Œæ–¹ä¾¿ä»£ç è®¿é—®ã€‚ excelä¸­è¿™ä¸€åˆ—ç”±ç¨‹åºå‘˜æ¥å¡«å†™ï¼Œåªæœ‰å°‘æ•°è¡Œéœ€è¦å¡«å†™ã€‚
- {}å†…æ¯è¡Œå¦‚æœä»¥[å¼€å§‹ï¼Œ åˆ™è¡¨ç¤ºæ˜¯åœ¨å®šä¹‰**å”¯ä¸€é”®**ï¼Œå”¯ä¸€é”®çš„å®šä¹‰è¦æ”¾åˆ°fieldå®šä¹‰ä¹‹å‰ã€‚
- å¦åˆ™è·Ÿstructç›¸åŒæ¯è¡Œå®šä¹‰fieldæˆ–å¤–é”®ã€‚

### ä¾‹å­

```
table completeconditiontype[id] (enum='name') {
	id:int; // ä»»åŠ¡å®Œæˆæ¡ä»¶ç±»å‹
	name:str; // ç¨‹åºç”¨åå­—
}

table taskexptype[id] (enum='name') {
	id:int; // ç»éªŒå…¬å¼ç±»å‹
	name:str; // ç¨‹åºç”¨åå­—
}

table task[taskid] (entry='entry') {
	[nexttask];
	taskid:int ->task.taskextraexp (nullable); // ä»»åŠ¡id
	entry:str;
	text:text; // éœ€è¦å›½é™…åŒ–çš„æ–‡æœ¬
	nexttask:int ->task (nullable);
	completecondition:task.completecondition; // ä»»åŠ¡å®Œæˆæ¡ä»¶
	exp:taskexp (mustFill);  // ç»éªŒå¥–åŠ±
	rewardItems:list<RewardItem> (block=1); // ç‰©å“å¥–åŠ±
	time:Time;
}
```

**è¯´æ˜ï¼š**
- `completeconditiontype`è¡¨ä½¿ç”¨äº†`(enum='name')`å±æ€§ï¼Œè¡¨æ˜è¿™æ˜¯ä¸ªæšä¸¾è¡¨ï¼ŒExcelä¸­nameåˆ—å¿…é¡»åŒ…å«`completecondition`æ¥å£ä¸­æ‰€æœ‰å®ç°ç±»çš„åç§°
- `taskexptype`è¡¨åŒæ ·ä½¿ç”¨äº†`(enum='name')`å±æ€§ï¼ŒExcelä¸­nameåˆ—å¿…é¡»åŒ…å«`taskexp`æ¥å£ä¸­æ‰€æœ‰å®ç°ç±»çš„åç§°
- `task`è¡¨çš„ä¸»é”®æ˜¯`taskid`ï¼Œä½¿ç”¨äº†`(entry='entry')`å±æ€§ï¼Œè¡¨æ˜æŸäº›è¡Œéœ€è¦ç¨‹åºä»£ç è®¿é—®ï¼Œentryåˆ—ç”±ç¨‹åºå‘˜å¡«å†™
- `task`è¡¨ä¸­å®šä¹‰äº†`[nexttask]`å”¯ä¸€é”®ï¼Œä¼šç”Ÿæˆå¯¹åº”çš„è®¿é—®ä»£ç `GetByNextTask`
- `task`è¡¨çš„`completecondition`å­—æ®µç±»å‹æ˜¯`task.completecondition`æ¥å£ï¼Œ`exp`å­—æ®µç±»å‹æ˜¯`taskexp`æ¥å£
- `task`è¡¨çš„`rewardItems`å­—æ®µæ˜¯`list<RewardItem>`ç±»å‹ï¼Œä½¿ç”¨äº†`(block=1)`å±æ€§

---

## ğŸ“‹ å®Œæ•´ä¾‹å­ï¼šä»»åŠ¡è¡¨

ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®Œæ•´çš„ä»»åŠ¡è¡¨ç»“æ„å®šä¹‰ï¼Œå±•ç¤ºäº†å¦‚ä½•å°†structã€interfaceå’Œtableç»„åˆä½¿ç”¨ï¼š

```
struct Range {
	rmin:int; // æœ€å°
	rmax:int; // æœ€å¤§
}

struct RewardItem {
	chance:int; // æ‰è½æ¦‚ç‡
	itemids:list<int> ->item.item (fix=2); // æ‰è½ç‰©å“
	range:Range; // æ•°é‡èŒƒå›´
}

struct Time (sep=':'){
    hour:int;
    minute:int;
    second:int;
}

interface completecondition (enumRef='completeconditiontype') {
	struct KillMonster {
		monsterid:int ->npc.monster;
		count:int;
	}

	struct TalkNpc {
		npcid:int ->npc.npcid;
	}

	struct ConditionAnd {
		cond1:task.completecondition (pack);
		cond2:task.completecondition (pack);
	}

	struct CollectItem {
		itemid:int ->item.item;
		count:int;
	}
}

interface taskexp (enumRef='taskexptype', defaultImpl='ConstValue', pack) {
    struct ByLevel { // ç©å®¶ç­‰çº§ç›¸å…³
		levelcoef:float;
		value:int;
	}

	struct ByServerUpDay { // æœåŠ¡å™¨å¯åŠ¨å¤©æ•°ç›¸å…³
		updaycoef1:float;
		updaycoef2:float;
		value:int;
	}

	struct ConstValue { // å›ºå®šå€¼
	    value:int;
	}
}

table completeconditiontype[id] (enum='name') {
	id:int; // ä»»åŠ¡å®Œæˆæ¡ä»¶ç±»å‹
	name:str; // ç¨‹åºç”¨åå­—
}

table taskexptype[id] (enum='name') {
	id:int; // ç»éªŒå…¬å¼ç±»å‹
	name:str; // ç¨‹åºç”¨åå­—
}

table task[taskid] (entry='entry') {
	[nexttask];
	taskid:int ->task.taskextraexp (nullable); // ä»»åŠ¡id
	entry:str;
	text:text; // éœ€è¦å›½é™…åŒ–çš„æ–‡æœ¬
	nexttask:int ->task (nullable);
	completecondition:task.completecondition; // ä»»åŠ¡å®Œæˆæ¡ä»¶
	exp:taskexp (mustFill);  // ç»éªŒå¥–åŠ±
	rewardItems:list<RewardItem> (block=1); // ç‰©å“å¥–åŠ±
	time:Time;
}
```

**æ•´ä½“è¯´æ˜ï¼š**
- è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•é€šè¿‡structã€interfaceå’Œtableçš„ç»„åˆæ¥æ„å»ºå¤æ‚çš„é…è¡¨ç»“æ„
- structç”¨äºå®šä¹‰åŸºæœ¬æ•°æ®ç»“æ„ï¼ˆRangeã€RewardItemã€Timeï¼‰
- interfaceç”¨äºå®šä¹‰å¤šæ€è¡Œä¸ºï¼ˆcompleteconditionã€taskexpï¼‰
- tableç”¨äºå®šä¹‰å®é™…çš„æ•°æ®è¡¨ç»“æ„ï¼ˆcompleteconditiontypeã€taskexptypeã€taskï¼‰
- é€šè¿‡å¤–é”®ï¼ˆ->ï¼‰å’Œæ¥å£å¼•ç”¨ï¼Œå„ä¸ªç»„ä»¶ä¹‹é—´å½¢æˆäº†ç´§å¯†çš„æ•°æ®å…³è”ç½‘ç»œ

