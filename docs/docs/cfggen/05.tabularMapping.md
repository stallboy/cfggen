---
layout: page
title: æ˜ å°„åˆ°è¡¨æ ¼
parent: é…è¡¨ç³»ç»Ÿ
nav_order: 5
---

# ğŸ—ºï¸ æ˜ å°„åˆ°è¡¨æ ¼
{: .no_toc }

{: .no_toc .text-delta }

- TOC
{:toc}
---

```
æˆ‘ä»¬è®¾è®¡çš„æ•°æ®æ”¯æŒåµŒå¥—ï¼Œå¤šæ€ï¼Œé€’å½’åµŒå¥—ï¼Œéå¸¸çµæ´»ï¼›è€Œexcelæ˜¯åŸºäºè¡¨æ ¼çš„ç»“æ„ã€‚
å¦‚ä½•æŠŠè¿™ç§éå¸¸çµæ´»çš„æ ‘çŠ¶ç”šè‡³é€’å½’çš„ç»“æ„ï¼Œæ˜ å°„åˆ°excelçš„ä¸€å±‚çš„å¹³å¦çš„è¡¨æ ¼ç»“æ„ä¸­å‘¢ï¼Ÿ
```

## ğŸ—‚ï¸ ç»“æ„æ˜ å°„åˆ°excelè¡¨æ ¼

è¿™é‡Œæˆ‘ä»¬æœ‰autoï¼Œpack, sep, fix, blockäº”ç§æ˜ å°„æ–¹å¼ã€‚

### ğŸ”„ auto

- **é€‚ç”¨ç±»å‹**ï¼šprimitiveã€structã€interface
- **å æ ¼è§„åˆ™**ï¼šprimitiveå 1æ ¼ï¼Œstruct/interfaceè‡ªåŠ¨è®¡ç®—
- **ç¤ºä¾‹**ï¼š

  ```
  struct Range {
      rmin:int; // æœ€å°
      rmax:int; // æœ€å¤§
  }
  ```
  
  Rangeç»“æ„å 2åˆ—

### ğŸ“¦ pack

- **é€‚ç”¨ç±»å‹**ï¼šstructã€interfaceã€listã€map
- **å æ ¼è§„åˆ™**ï¼šæ•´ä¸ªç»“æ„å‹ç¼©åˆ°1æ ¼
- **åˆ†éš”ç¬¦**ï¼šä½¿ç”¨é€—å·æˆ–åˆ†å·åˆ†éš”ï¼Œå†…åµŒç»“æ„ä½¿ç”¨()æ¥åŒ…è£¹
- **ç¤ºä¾‹**ï¼š

  ```
  struct Position (pack) {
      x:int;
      y:int;
      z:int;
  }
  ```

  æ•°æ®æ ¼å¼ï¼š"1,2,3"

  ```
  list<Position> (pack)
  ```

  æ•°æ®æ ¼å¼ï¼š"(1,2,3);(4,5,6)"

- å½“æœ‰ç»“æ„æˆç¯(é€’å½’)æ—¶ï¼Œå¿…ç„¶è¦æœ‰ä¸€å¤„è®¾ç½®packï¼Œæ‰“ç ´ç¯ï¼Œè¿™æ ·æ‰èƒ½è®¡ç®—æ‰€å åˆ—æ•°


### ğŸ”€ sep

- **é€‚ç”¨ç±»å‹**ï¼šstructã€list
- **å æ ¼è§„åˆ™**ï¼šæ•´ä¸ªç»“æ„å‹ç¼©åˆ°1æ ¼
- **åˆ†éš”ç¬¦**ï¼šè‡ªå®šä¹‰åˆ†éš”ç¬¦ï¼ˆ:ã€=ã€$ç­‰ï¼‰
- **ç¤ºä¾‹**ï¼š

  ```
  struct Time (sep=':'){
      hour:int;
      minute:int;
      second:int;
  }
  ```

  æ•°æ®æ ¼å¼ï¼š"12:10:00"

- structé‡Œfieldåªæœ‰éƒ½æ˜¯primitiveï¼Œæ‰èƒ½è®¾ç½®sep
- ä¸æ”¯æŒtypeä¸ºstructçš„fieldä¸Šè®¾ç½®sepï¼ˆè¯·åœ¨structä¸Šè®¾ç½®ï¼Œä¸ºäº†ç®€å•ä¸€è‡´æ€§ï¼‰
- å¦‚æœfieldæ˜¯`list<struct>`ç»“æ„ï¼Œsepå’Œè¦çš„åˆ†å‰²ç¬¦æœ‰åŒºåˆ†æ‰è¡Œ
- å¦‚æœä¸æ˜¯ç‰¹åˆ«éœ€è¦ç”¨æŸä¸ªåˆ†éš”ç¬¦ï¼Œå»ºè®®ç”¨æ›´å¼ºå¤§çš„pack


### ğŸ”’ fix

- **é€‚ç”¨ç±»å‹**ï¼šlistã€map
- **å æ ¼è§„åˆ™**ï¼šå›ºå®šåˆ—æ•° = å…ƒç´ ç±»å‹å æ ¼ Ã— count
- **å‚æ•°**ï¼šcount - å›ºå®šé•¿åº¦
- **ç¤ºä¾‹**ï¼š

  ```
  list<int> (fix=2) // å 2åˆ—
  ```

### ğŸ§± block

- **é€‚ç”¨ç±»å‹**ï¼šlistã€map
- **å æ ¼è§„åˆ™**ï¼šæ¨ªå‘å›ºå®šï¼Œçºµå‘æ‰©å±•
- **å‚æ•°**ï¼šfix - æ¨ªå‘åˆ—æ•°
- **ç¤ºä¾‹**ï¼š

  ```
  list<RewardItem> (block=1) // æ¨ªå‘å 1Ã—RewardItemåˆ—æ•°ï¼Œçºµå‘ä»»æ„
  ```


## ğŸ§  blockç®—æ³•

- è¯»å–blockçš„ç®—æ³•å¦‚ä¸‹ï¼š

	```java
	if (line.getFirst().isCellEmpty()) {  // ç¬¬ä¸€æ ¼ä¸ºç©ºï¼Œè¿˜æ˜¯æœ¬record
		DCell prevCell = line.get(firstColIndex - 1);
		DCell thisCell = line.get(firstColIndex);

		if (prevCell.isCellEmpty()) { // ä¸Šä¸€æ ¼ä¸ºç©ºï¼Œ
			if (thisCell.isCellEmpty()) { // æœ¬æ ¼ä¹Ÿä¸ºç©ºï¼Œå†…éƒ¨çš„åµŒå¥—blockï¼Œå¿½ç•¥
			} else { //æœ¬æ ¼ä¸ä¸ºç©º -ã€‹ æ˜¯è¿™ä¸ªblockäº†
				res.add(new CellsWithRowIndex(line.subList(firstColIndex, firstColIndex + colSize), row));
			}
		} else {// ä¸Šä¸€ä¸ªä¸ä¸ºç©ºï¼Œç»“æŸ
			break;
		}
	} else { // ä¸‹ä¸€ä¸ªrecordï¼Œç»“æŸ
		break;
	}
	```

- blockæ”¯æŒåµŒå¥—

	```java
	// è¦å…è®¸block<struct>,structé‡Œä»ç„¶æœ‰blockï¼Œå¦‚ä¸‹æ‰€ç¤º
	//1. xxxaebbxccc
	//2.      bb cc
	//3.      bb
	//4.    aebb
	//5.      bb
	// è¿™é‡Œaebæ˜¯ä¸ªblock=1ï¼Œbæ˜¯ä¸ªblock=2ï¼Œcæ˜¯ä¸ªblock=3
	// aebbå‰é¢ä¸€åˆ—è¦æœ‰ç©ºæ ¼ï¼Œbbå‰ä¸€åˆ—æ ¼å­ä¹Ÿè¦æ˜¯ç©ºï¼Œcccå‰ä¸€åˆ—ä¹Ÿæ˜¯æœ‰ä¸ªç©ºï¼Œ
	// ç”¨è¿™ä¸ªç©ºæ¥åšä¸ºæ ‡è®°ï¼Œæ”¯æŒblock aebbåµŒå¥—block bbï¼Œæ¥åˆ¤æ–­æ­¤è¡Œbbæ˜¯å¦å±äºåµŒå¥—çš„bbè¿˜æ˜¯æ–°èµ·çš„aabb
	// è¿™æ ·ä¹Ÿå¼ºåˆ¶äº†2ä¸ªåŒçº§çš„blockä¸è¦ç›´æ¥è¡”æ¥ï¼Œè§†è§‰ä¸Šä¸å¥½åŒºåˆ†ï¼Œ
	// å¯ä»¥åœ¨ä¸­é—´åŠ å…¥ä¸€ä¸ªåˆ—ï¼Œæ¯”å¦‚ä»¥ä¸Šçš„aebbå’Œcccç›´æ¥æœ‰xæ¥åˆ†å‰²
	// ä»¥ä¸Šè§„åˆ™ç°åœ¨æ²¡æœ‰åšæ£€æµ‹ï¼Œè¦æ£€æµ‹æœ‰ç‚¹å¤æ‚ï¼Œäººå·¥ä¿è¯å§ã€‚
	```

	å‡å¦‚ä»¥ä¸Šç¬¬4è¡Œçš„aebbï¼Œeè¿™ä¸ªexcelæ ¼å­ä¸ºç©ºï¼Œåˆ™åœ°4.5è¡Œåªæå–å‡ºæ¥äº†bbä¿¡æ¯ï¼Œåˆå¹¶åˆ°ç¬¬1è¡Œæ•´ä½“çš„aebç»“æ„é‡Œï¼Œè€Œä¸æ˜¯ä»ç¬¬å››è¡Œåˆæ–°å»ºäº†ä¸ªaebç»“æ„ã€‚

	è¿™ä¸ªå®¹æ˜“å¼•èµ·bugï¼Œå¦‚ä½•é¿å…ï¼Ÿä¸‹èŠ‚å¼•å…¥mustFill

## âœ… mustFill

- å¯ä»¥åœ¨fieldä¸ŠåŠ mustFillã€‚listã€mapç±»å‹è¡¨ç¤ºå…ƒç´ ä¸ªæ•°å¿…é¡»å¤§äº0ï¼Œå…¶ä»–ç±»å‹è¡¨ç¤ºæ ¼å­ä¸èƒ½ä¸ºç©ºã€‚
- ä¸ºé¿å…ä¸Šä¸€èŠ‚aebé‡Œçš„eæ ¼å­å¯ä¸ºç©ºï¼Œå¯¼è‡´çš„æƒŠè®¶ï¼Œå¯ä»¥è®¾ç½®eå¯¹åº”çš„field (mustFill)ï¼Œè¿™æ ·ä¸‡ä¸€å¿˜äº†å¡«eæ ¼å­ï¼Œä¼šæŠ¥é”™

  ```
  exp:taskexp (mustFill);  // ç»éªŒå¥–åŠ±
  rewardItems:list<RewardItem> (block=1); // ç‰©å“å¥–åŠ±
  ```

  exp è®¾ç½®äº†mustFillï¼Œè¡¨ç¤ºå¿…é¡»é…ç½®ï¼Œä¸èƒ½çœç•¥

## ğŸ“‹ ä¾‹å­

### ğŸ”„ auto

```
table weapon[id] {
    id:int;
    weaponAttrs:weaponAttr; // Damage
}

interface weaponAttr{
    struct Damage {
        value:int;
    }
}
```

| id  | weaponAttrs | weaponAttrs |
| --- | ----------- | ----------- |
| 1   | Damage      | 2           |
| 2   | Damage      | 2           |

æ²¡æœ‰packï¼Œæ­¤æ—¶ç±»å‹å’Œæ•°å€¼éœ€è¦æ‹†åˆ†åˆ°2æ ¼



### Fix List

```
interface weaponAttr (pack){
	struct Damage{
		value:int;
	}
}

table test[id] {
	id:str; // æ³¨é‡Šè¡Œ
	weaponAttrs:list<weaponAttr>(fix=2); // Damage
}
```

| id  | weaponAttrs | weaponAttrs | weaponAttrs | weaponAttrs |
| --- | ----------- | ----------- | ----------- | ----------- |
| 1   | Damage      | 2           |             |             |
| 2   | Damage      | 2           |             |             |

### Pack Struct

æœ‰ä¸¤ç§åšæ³•ï¼Œä¸€ä¸ªæ˜¯æ ‡æ³¨åœ¨structä¸Šï¼Œä¸€ä¸ªæ˜¯æ ‡æ³¨åœ¨å˜é‡ä¸Š

```
struct DmgRatio1 {
	playerAttr:int;
	ratio:int;
}

struct DmgRatio2 (pack) {
	playerAttr:int;
	ratio:int;
}
struct DmgRatio3 {
	playerAttr:int;
	ratio:int;
}
table test[id] {
	id:int; // æ³¨é‡Šè¡Œ
	DmgRatio1:DmgRatio1; // Damage
	DmgRatio2:DmgRatio2;
	DmgRatio3:DmgRatio3(pack);
}
```

| id  | DmgRatio1 | DmgRatio1 | DmgRatio2 | DmgRatio3 |
| --- | --------- | --------- | --------- | --------- |
| 1   | 1         | 1         | 2,2       | 3,3       |

### Interface

å‡ºç°Interfaceæ—¶ï¼Œé…ç½®é‡Œå¿…é¡»è¦è¡¨æ˜structçš„ç±»å‹ã€‚

```
interface IDmgRatio{
    struct DmgRatio1 {
        playerAttr:int;
        ratio:int;
    }

    struct DmgRatio2 {
    	playerAttr:int;
    	ratio:int;
    }
}

table test[id] {
	id:int; // æ³¨é‡Šè¡Œ
	DmgRatio1:IDmgRatio;
	DmgRatio2:IDmgRatio;
}
```

| id  | DmgRatio1 | DmgRatio1 | DmgRatio1 | DmgRatio2 | DmgRatio2 | DmgRatio2 |
| --- | --------- | --------- | --------- | --------- | --------- | --------- |
| 1   | DmgRatio1 | 1         | 1         | DmgRatio2 | 2         | 2         |

### Pack Interface

å‡ºç°interfaceæ—¶ï¼Œpackåªèƒ½æ ‡æ³¨åœ¨interfaceä¸Šï¼Œä¸èƒ½æ ‡æ³¨åœ¨structä¸Šã€‚å¯¼è‡´æ‰€æœ‰ç±»å‹éƒ½å˜æˆ1æ ¼ã€‚

```
interface IDmgRatio(pack){
    struct DmgRatio1 {
        playerAttr:int;
        ratio:int;
    }

    struct DmgRatio2 {
    	playerAttr:int;
    	ratio:int;
    }
}

table test[id] {
	id:int; // æ³¨é‡Šè¡Œ
	DmgRatio1:IDmgRatio;
	DmgRatio2:IDmgRatio;
}
```


### Pack list

å…ˆçœ‹åŸå§‹çš„ï¼š

```
interface TestAttr (pack) {
	struct Damage {
		value:int;
	}

	struct Range {
		value:int;
	}

}

struct TestStruct (pack) {
	playerAttr:int;
	ratio:int;
}

table test[id] {
	id:int; // æ³¨é‡Šè¡Œ
	TestStruct:list<TestStruct> (pack);
	attrs:list<TestAttr>(pack);
	sepAttr:list<TestAttr>(sep=';');
}


```

| id  | TestStruct | TestStruct | attrs  | attrs | attrs | attrs |
| --- | ---------- | ---------- | ------ | ----- | ----- | ----- |
| 1   | 1,2        | 1,2        | Damage | 50    | Range | 6     |

### å¯¹Interfaceå’Œstructåšpackï¼Œsep

```
interface TestAttr (pack) {
	struct Damage {
		value:int;
	}

	struct Range {
		value:int;
	}

}

struct TestStruct (pack) {
	playerAttr:int;
	ratio:int;
}

table test[id] {
	id:int; // æ³¨é‡Šè¡Œ
	TestStruct:list<TestStruct> (pack);
	attrs:list<TestAttr>(pack);
	sepAttr:list<TestAttr>(sep=';');
}


```

| id  | TestStruct  | attrs               | sepAttr             |
| --- | ----------- | ------------------- | ------------------- |
| 1   | (1,2),(2,4) | Damage(50),Range(6) | Damage(50);Range(6) |


### å¿…é¡»ç”¨packçš„æƒ…å†µ

``` 
interface CompleteCondition {
	struct KillMonster {
		monsterid:int;
		count:int;
	}

	struct TalkNpc {
		npcid:int;
	}

	struct CollectItem {
		itemid:int;
		count:int;
	}

	struct And {
		cond1:CompleteCondition (pack);
		cond2:CompleteCondition (pack);
	}

	
}
```

ä»»åŠ¡è¡¨ä¸ºï¼š

```
table task...{
    ...
    condition: CompleteCondition;
}
```

| condition   | param1       | param2               |
|:------------|--------------|----------------------|
| KillMonster |1001          |1                     |
| And         |TalkNpc(5)    |CollectItem(2002, 3)  |


- And é‡Œçš„cond1 cond2éƒ½è®¾ç½®äº†(pack)ï¼Œåˆ™è¿™ä¸¤ä¸ªfieldå„å ä¸€åˆ—ï¼ŒAnd æ€»å…±å 2åˆ—ã€‚
- å¯¹äºè¿™ä¸ªå½¢æˆäº†ç¯çš„é€’å½’ç»“æ„ï¼Œå¿…é¡»åœ¨æŸå¤„ç”¨packæ‰“æ–­ï¼Œè¦ä¸ç„¶æ‰€å åˆ—æ•°å°±æ— æ³•è®¡ç®—ã€‚è¿™é‡Œå°±æ˜¯cond1ï¼Œcond2å¤„æ‰“æ–­çš„ã€‚
