# 核心模块说明

## 模块概览

cfggen 项目采用模块化设计，每个模块负责特定的功能领域。以下是各核心模块的详细说明。

## 1. ctx - 上下文管理模块

### 功能描述
管理配置数据的上下文信息，包括目录结构、文件解析配置和运行时状态。

### 核心类

#### Context
- **位置**：`configgen.ctx.Context`
- **功能**：核心上下文类，包含所有配置处理所需的信息
- **主要属性**：
  - 数据目录路径
  - 显式目录配置
  - 表头行设置
  - 国际化配置
  - 编码设置

#### DirectoryStructure
- **功能**：管理数据目录的结构
- **职责**：
  - 扫描数据文件
  - 构建文件树
  - 处理嵌套目录

#### ExplicitDir
- **功能**：处理显式目录配置
- **配置项**：
  - `asroot`：作为根目录处理的文件
  - `exceldirs`：Excel文件目录
  - `jsondirs`：JSON文件目录

#### HeadRow / HeadRows
- **功能**：管理表头行配置
- **支持类型**：
  - 单行表头
  - 多行表头
  - 自定义表头格式

#### Watcher / WaitWatcher
- **功能**：文件变化监听
- **用途**：
  - 监控文件修改
  - 触发重新生成
  - 开发时热重载

## 2. data - 数据读取模块

### 功能描述
从不同格式的文件中读取配置数据，支持CSV、Excel、JSON等格式。

### 核心类

#### CfgData
- **功能**：配置数据容器
- **职责**：
  - 存储解析后的数据
  - 提供数据访问接口
  - 管理数据关系

#### ExcelReader
- **功能**：Excel文件读取器
- **特性**：
  - 支持.xlsx格式
  - 高性能读取
  - 内存优化

#### ReadCsv
- **功能**：CSV文件读取器
- **特性**：
  - 支持GBK编码
  - 自动BOM检测
  - 高效流式处理

#### ReadByFastExcel
- **功能**：使用FastExcel库读取Excel
- **优势**：
  - 高性能
  - 低内存占用
  - 大文件支持

#### ReadByPoi（可选）
- **功能**：使用Apache POI读取Excel
- **用途**：
  - 兼容性测试
  - 功能对比
  - 备用读取方案

#### CellParser / HeadParser
- **功能**：单元格和表头解析
- **职责**：
  - 数据类型推断
  - 格式验证
  - 错误处理

## 3. gen - 生成器框架

### 功能描述
提供代码生成的基类框架，支持多种编程语言的代码生成。

### 核心类

#### Generator
- **功能**：生成器抽象基类
- **主要方法**：
  - `generate(Context ctx)`：生成代码
  - 模板方法模式实现

#### Generators
- **功能**：生成器注册和管理
- **职责**：
  - 注册生成器提供者
  - 创建生成器实例
  - 参数收集和验证

#### Main
- **功能**：程序入口点
- **职责**：
  - 命令行参数解析
  - 上下文初始化
  - 生成器调度

## 4. 语言特定生成器

### genjava - Java代码生成
- **功能**：生成Java数据类和工具类
- **输出**：
  - POJO类
  - 数据访问类
  - 序列化支持

### gencs - C#代码生成
- **功能**：生成C#代码和字节码
- **特性**：
  - .NET兼容
  - 类型安全
  - 性能优化

### gents - TypeScript代码生成
- **功能**：生成TypeScript代码和Schema
- **输出**：
  - TypeScript接口
  - 类型定义
  - 运行时验证

### gengo - Go代码生成
- **功能**：生成Go语言代码
- **特性**：
  - Go模块结构
  - 类型映射
  - 标准库兼容

### genlua - Lua代码生成
- **功能**：生成Lua脚本
- **用途**：
  - 游戏配置
  - 脚本化配置
  - 运行时加载

## 5. schema - Schema管理

### 功能描述
处理配置Schema的定义、解析和验证。

### 核心类

#### cfg包
- **功能**：Schema配置定义
- **包含**：
  - 类型定义
  - 字段定义
  - 约束条件

#### CfgSchemaAlignToData
- **功能**：Schema与数据对齐
- **职责**：
  - 验证数据完整性
  - 类型兼容性检查
  - 自动类型推断

## 6. i18n - 国际化支持

### 功能描述
提供多语言术语管理和国际化支持。

### 核心类

#### TermChecker
- **功能**：术语检查器
- **用途**：
  - 多语言术语验证
  - 兼容性检查
  - 术语一致性

#### GenI18nByValue / GenI18nById
- **功能**：国际化代码生成
- **支持**：
  - 基于值的国际化
  - 基于ID的国际化
  - 语言切换支持

## 7. editorserver - 编辑器服务器

### 功能描述
提供Web编辑器服务，支持在线配置编辑和预览。

### 核心类

#### EditorServer
- **功能**：编辑器服务器主类
- **特性**：
  - HTTP服务
  - 实时预览
  - 配置验证

#### 各种Service类
- **功能**：提供特定编辑功能
- **包含**：
  - SchemaService：Schema管理
  - RecordService：记录操作
  - SearchService：搜索功能
  - PromptService：AI提示

## 8. tool - 工具模块

### 功能描述
提供各种辅助工具和命令行功能。

### 核心类

#### ValueSearcher
- **功能**：值搜索工具
- **特性**：
  - 全文搜索
  - 标签过滤
  - 交互式搜索

#### BinaryToText
- **功能**：二进制到文本转换
- **用途**：
  - 调试输出
  - 数据导出
  - 格式转换

#### XmlToCfg
- **功能**：XML到CFG格式转换
- **用途**：
  - 格式迁移
  - 兼容性支持
  - 工具链集成

## 9. util - 工具类

### 功能描述
提供通用的工具类和辅助功能。

### 核心类

#### CachedFiles
- **功能**：缓存文件管理
- **特性**：
  - 文件缓存
  - 增量更新
  - 性能优化

#### Logger
- **功能**：日志记录
- **支持**：
  - 多级别日志
  - 性能分析
  - 内存监控

#### LocaleUtil
- **功能**：本地化工具
- **职责**：
  - 语言环境管理
  - 字符串本地化
  - 格式处理

---
*最后更新：2025-11-04*